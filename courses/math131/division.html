 <!DOCTYPE html>
<html lang="en">
<head>
  <meta name="description" content="Personal website of Ben Fraser, with math education activities for students and teachers.">
  <meta charset="UTF-8" />
  <title>Division Activity</title>
  <link rel="stylesheet" href="/style.css" />

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
</head>
<body>
  <header>
    <h1>Division Activity</h1>
    <div id="nav-placeholder"></div>
      <script>
        fetch("/nav.html")
          .then(response => response.text())
          .then(data => {
            document.getElementById("nav-placeholder").innerHTML = data;
        
            const currentPath = window.location.pathname.replace(/\/index\.html$/, "/");
            const navLinks = document.querySelectorAll("#nav-placeholder a");
        
            navLinks.forEach(link => {
              const linkPath = new URL(link.href).pathname.replace(/\/index\.html$/, "/");
              if (linkPath === currentPath) {
                link.classList.add("active");
              }
            });
          });
      </script>
  </header>
  <main>

    <p>Long division.  Aside from its well-known uses as a torture technique by autocratic nations, we also have to learn it in grade school, as part 
     of some twisted rite of passage.  All kidding aside, it's not as bad as it seems.  The standard algorithm for long division may be one of the 
    first points in your math education where you decided the connection between the algorithm and reality wasn't clear, and decided to just 
    memorize the algorithm, and defer deeper understanding of it.</p>

   <p>But understanding it more deeply, aside from the pedagaogical benefits, also prepares you to do more difficult division problems: the same 
   principles we use in integer division apply to the division of polynomials by one another!  We won't tackle that monstrosity in this class, but 
   rather learn the <i>flexible scaffold</i> method of division - a strategy to slowly chunk away at a division problem.</p>

   <div style="display: flex; justify-content: space-between; gap: 20px; text-align: center;">
      <div style="flex: 1;">
        Flexible scaffold
        \[
       \require{enclose}
       \begin{array}{rr}
       & 3 \hspace{1mm}\\
       & 5 \hspace{1mm}\\
       & 10 \hspace{1mm}\\
       & 10 \hspace{1mm}\\
       8 & \enclose{longdiv}{224} \\
       & \underline{- {\color{ForestGreen}80}} \hspace{1mm}\\
       & 144 \hspace{1mm}\\
       & \underline{- {\color{blue}80}} \hspace{1mm}\\
       & 64 \hspace{1mm}\\
       & \underline{- {\color{purple}40}} \hspace{1mm}\\
       & 24 \hspace{1mm}\\
       & \underline{- {\color{orange}24}} \hspace{1mm}\\
       & 0 \hspace{1mm}
       \end{array}
       \]
      </div>

      <div style="flex: 1;">
        Sum the "partial quotients"
        \[
       \Longrightarrow
       \]
       <figure style="text-align: center;">
          <img src="fig9.png" alt="Flexible scaffold division of 224/28" style="display: inline-block;">
        </figure>
      </div>
    
      <div style="flex: 1;">
        Standard algorithm
        \[
        \require{enclose}
        \begin{array}{rr}
        & 28 \hspace{1mm}\\
        8 & \enclose{longdiv}{224} \\
        & \underline{- 160} \hspace{1mm}\\
        & 64 \hspace{1mm}\\
        & \underline{- 64} \hspace{1mm}\\
        & 0 \hspace{1mm}
        \end{array}
        \]
      </div>
    </div>

      
      <p>In this way, we can reduce the problem into one where we compute a <i>sum</i> of what we term "partial quotients", that are perhaps easier to 
       compute products with (does this strategy seem familiar from the multiplication activity?)  It is up to personal preference what numbers you 
       choose - but like the Price is Right, try picking as large "partial quotients" as you can without <i>going over</i>.  Here are the multiplication 
       tables for your reference:</p>
    

   <div style="display: flex; justify-content: space-between; gap: 20px; text-align: center;">
      <div style="flex: 1;">
        Base-ten multiplication table
        \[
        \begin{array}{|c|cccccccccc|}
        \hline
        \times & 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 \\
        \hline
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        1 & 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 \\
        2 & 0 & 2 & 4 & 6 & 8 & 10 & 12 & 14 & 16 & 18 \\
        3 & 0 & 3 & 6 & 9 & 12 & 15 & 18 & 21 & 24 & 27 \\
        4 & 0 & 4 & 8 & 12 & 16 & 20 & 24 & 28 & 32 & 36 \\
        5 & 0 & 5 & 10 & 15 & 20 & 25 & 30 & 35 & 40 & 45 \\
        6 & 0 & 6 & 12 & 18 & 24 & 30 & 36 & 42 & 48 & 54 \\
        7 & 0 & 7 & 14 & 21 & 28 & 35 & 42 & 49 & 56 & 63 \\
        8 & 0 & 8 & 16 & 24 & 32 & 40 & 48 & 56 & 64 & 72 \\
        9 & 0 & 9 & 18 & 27 & 36 & 45 & 54 & 63 & 72 & 81 \\
        \hline
        \end{array}
        \]
      </div>
    
      <div style="flex: 1;">
        Base-five multiplication table
        \[
        \begin{array}{|c|ccccc|}
        \hline
        \times & 0 & 1 & 2 & 3 & 4 \\
        \hline
        0 & 0 & 0 & 0 & 0 & 0 \\
        1 & 0 & 1 & 2 & 3 & 4 \\
        2 & 0 & 2 & 4 & 11 & 13 \\
        3 & 0 & 3 & 11 & 14 & 22 \\
        4 & 0 & 4 & 13 & 22 & 31 \\
        \hline
        \end{array}
        \]
      </div>
    </div>

    <p><i>In the below activity, note that if you use too many partial quotients (more than ten), it will "break" the activity box, which has limited 
     size.</i></p>

    <div id="rule-select" class="styled-checkbox-group">
      <label><input type="checkbox" class="styled-checkbox" id="baseten"> Base-Ten</label>
      <label><input type="checkbox" class="styled-checkbox" id="basefive"> Base-Five</label>
    </div>
    
    <div class="button-container">
      <button id="start-btn" class="rubber-button">Start!</button>
    </div>
    
    <p id="question-text"></p>

    <div id="partial-quotient-container" style="display: none; text-align: center; margin-top: 10px;">
       <input id="partial-quotient-input" type="number" />
   </div>

    <div class="button-container">
      <button id="next-btn" class="rubber-button">Next</button>
    </div>

   <div style="text-align: center; margin-top: 10px;">
       <p id="feedback" style="display: none; margin: 0;"></p>
   </div>

   <div id="latex-container" style="display: none;"></div>
    
    <div class="activity-box-large" id="my-activity">

    </div>

    <div id="final-answer-input" style="text-align: center; margin-top: 1em;"></div>

    <div class="button-container">
      <button id="check-btn" class="rubber-button" style="display: none;">Check Answer</button>
    </div>
    
    <div class="button-container">
      <div id="feedbackText" class="center-feedback"></div>
    </div>





  </main>

  <script>

    // Variable count will keep track of the number of partial quotients successfully input
    let count = 0;
    let partialQuotients = [];
    let partialDifferences = [];

    const feedback = document.getElementById("feedback");


    const ruleCheckboxes = {
      baseten: document.getElementById('baseten'),
      basefive: document.getElementById('basefive'),
    };
    
    Object.values(ruleCheckboxes).forEach(box => {
      box.addEventListener('change', () => {
        // Mutual exclusion for base-ten and base-five
        if (box.id === 'baseten' && box.checked) {
          ruleCheckboxes.basefive.checked = false;
        }
        if (box.id === 'basefive' && box.checked) {
          ruleCheckboxes.baseten.checked = false;
        }
      });
    });

    // a and b are the multiplicands (b is the final answer), c is what we are dividing into, and d is the running total (as we subtract from c)
    let a, b, c, d;
   
    const nextBtn = document.getElementById('next-btn');
    const hintArea = document.getElementById('hint-area');
    

    const startBtn = document.getElementById('start-btn');
    const questionText = document.getElementById('question-text');
    const activityBox = document.getElementById('my-activity');


    function drawCanvas() {
      activityBox.innerHTML = ''; // clear
      const canvas = document.createElement('canvas');
      canvas.width = 1300;
      canvas.height = 1200;
      activityBox.appendChild(canvas);
      const ctx = canvas.getContext('2d');
      
      ctx.strokeStyle = 'black';
      ctx.lineWidth = 4;
      ctx.beginPath();
      ctx.moveTo(205, 390);
      ctx.lineTo(285, 390);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(205, 390);
      ctx.lineTo(205, 425);
      ctx.stroke();

      // Now draw the label values
      ctx.font = "bold 30px Arial";
      ctx.fillStyle = "black";
      ctx.textAlign = "right"; 
      ctx.fillText(a, 200, 420);
      if (ruleCheckboxes.basefive.checked) {
       ctx.fillText(c.toString(5), 280, 420);
      } else {
       ctx.fillText(c, 280, 420);
      }


      // Stack partial quotients upward
      const startX = 280;  // align with c
      let startY = 380;    // just above c
      const lineHeight = 35;
  
      ctx.textAlign = "right"; 
      for (let i = 0; i < partialQuotients.length; i++) {
          ctx.fillText(partialQuotients[i], startX, startY - i * lineHeight);
      }


       startY = 490;    // just below c
       const lineHeight2 = 67;
   
       ctx.textAlign = "right"; 
       for (let i = 0; i < partialDifferences.length; i++) {
           if (ruleCheckboxes.basefive.checked) {
            ctx.fillText((parseInt(partialQuotients[i].toString(), 5) * a).toString(5) * -1, startX, startY + i * lineHeight2 - 35);
           } else {
            ctx.fillText(partialQuotients[i] * a * -1, startX, startY + i * lineHeight2 - 35);
           }
           ctx.beginPath();
           ctx.moveTo(205, startY + i * lineHeight2 - 30);
           ctx.lineTo(285, startY + i * lineHeight2 - 30);
           ctx.stroke();
           if (ruleCheckboxes.basefive.checked) {
            ctx.fillText(partialDifferences[i].toString(5), startX, startY + i * lineHeight2);
           } else {
            ctx.fillText(partialDifferences[i], startX, startY + i * lineHeight2);
           }
       }

    }








    
  startBtn.addEventListener('click', () => {

      const pqContainer = document.getElementById("partial-quotient-container");
      const pqInput = document.getElementById("partial-quotient-input");

      partialQuotients = [];
      partialDifferences = [];
      
      pqInput.value = ""; // clear old value
      pqContainer.style.display = "block"; // show container (and input inside)
      pqInput.focus();

      feedback.style.display = "none"; // hide by default

      const feedback2 = document.getElementById('feedbackText');
      feedback2.textContent = '';

      // Play sound when view button is clicked
      const sound = document.getElementById('click-sound');
      if (sound) {
        sound.currentTime = 0; // rewind to start in case it's still playing
        sound.play();
      }

      if (ruleCheckboxes.basefive.checked) {
       a = Math.floor(Math.random() * 3) + 2;
      } else {
       // Generate a single digit number between 2 and 9
       a = Math.floor(Math.random() * 8) + 2;
      }

      b = 0;
      // Ensure that the product of a and b has 4 digits
      if (ruleCheckboxes.basefive.checked) {
       while (a * b < 125) {
          b = Math.floor(Math.random() * 100) + 25;
       }
      } else {
        while (a * b < 1000) {
          b = Math.floor(Math.random() * 900) + 100;
       }
      }

      c = a * b;
      d = c;


      // Display the question
      questionText.textContent = `What is \\(${ruleCheckboxes.basefive.checked ? c.toString(5) : c.toString(10)} \\div 
      ${ruleCheckboxes.basefive.checked ? a.toString(5) : a.toString(10)}\\)?  Input partial quotients below:`;

      MathJax.typeset([questionText]);

      
      // Clear the activity box
      activityBox.innerHTML = '';

    

      //drawCanvas(mode, inputElements, []);




    });


    const checkBtn = document.getElementById('check-btn');
    const feedbackText = document.getElementById('feedbackText');
    
    checkBtn.addEventListener('click', () => {
      // Play click sound
      const sound = document.getElementById('click-sound');
      if (sound) {
        sound.currentTime = 0;
        sound.play();
      }
    
      let correct = true;
    
      // Give feedback
      if (correct) {
        feedbackText.textContent = "Correct!";
        feedbackText.style.color = "green";
      } else {
        feedbackText.textContent = "Incorrect. Try again!";
        feedbackText.style.color = "red";
      }
    });


    nextBtn.addEventListener('click', () => {
      console.log(`Next clicked`);
      const sound = document.getElementById('click-sound');
      if (sound) {
        sound.currentTime = 0;
        sound.play();
      }

      feedback.style.display = "none"; // hide by default

      const inputVal = document.getElementById("partial-quotient-input").value.trim();
      const partialQuotient = parseInt(inputVal, 10);
      let internalQuotient = partialQuotient;
      if (ruleCheckboxes.basefive.checked) {
          internalQuotient = parseInt(partialQuotient, 5);
      }
  
      // Check for positive integer
      if (!Number.isInteger(internalQuotient) || internalQuotient <= 0) {
          feedback.textContent = "Enter a positive integer.";
          if (ruleCheckboxes.basefive.checked) {
              feedback.textContent = "Enter a valid base-five positive integer.";
          }
          feedback.style.color = "black";
          feedback.style.display = "block";
          return;
      }
  
      // Check if overshot
      if (internalQuotient * a > d) {
          feedback.textContent = "Overshot: enter a smaller number.";
          feedback.style.color = "red";
          feedback.style.display = "block";
          return;
      }
  
      // If valid, process
      d -= internalQuotient * a;
      partialQuotients.push(partialQuotient);
      partialDifferences.push(d); // store new running difference
      count++;
  
      console.log(`Partial quotient accepted: ${partialQuotient}`);
      console.log(`New remainder (d): ${d}`);
      console.log(`Partial quotients: ${partialQuotients}`);
      console.log(`Partial differences: ${partialDifferences}`);
  
      // Clear the input
      document.getElementById("partial-quotient-input").value = "";
      drawCanvas();
  });
  

    
  </script>

  <audio id="click-sound" src="button.mp3" preload="auto"></audio>
  <audio id="set-sound" src="set2.mp3" preload="auto"></audio>
  
</body>
</html>
