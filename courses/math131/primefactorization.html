
<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="description" content="Personal website of Ben Fraser, with math education activities for students and teachers.">
  <meta charset="UTF-8" />
  <title>Prime Factorization Activity</title>
  <link rel="stylesheet" href="/style.css" />

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
</head>
<body>
  <header>
    <h1>Prime Factorization Activity</h1>
    <div id="nav-placeholder"></div>
      <script>
fetch("/nav.html")
  .then(response => response.text())
  .then(html => {
    document.getElementById("nav-placeholder").innerHTML = html;

    const currentPath = window.location.pathname.replace(/\/index\.html$/, "/");
    const navLinks = document.querySelectorAll("#nav-placeholder a");
    navLinks.forEach(link => {
      const linkPath = new URL(link.href).pathname.replace(/\/index\.html$/, "/");
      if (linkPath === currentPath) {
        link.classList.add("active");
      }
    });

    const s = document.createElement("script");
    s.src = "/mascot.js";
    s.defer = true;
    document.body.appendChild(s); 
  })
  .catch(err => {
    console.error("Failed to load nav:", err);
  });
</script>
  </header>
  <main>

    <p>This is a placeholder for what will be a prime factorization activity.  Work in progress.</p>
    
    <div class="button-container">
      <button id="start-btn" class="rubber-button">Start!</button>
    </div>
    
    <p id="question-text"></p>

    <div class="activity-box" id="my-activity">

    </div>
    
    <div class="button-container">
      <div id="feedbackText" class="center-feedback"></div>
    </div>

  </main>

  <script>


    let a = 0, a2 = 0, a3 = 0, a5 = 0, a7 = 0, a11 = 0, an = 0, anum = 0;
    let b = 0, b2 = 0, b3 = 0, b5 = 0, b7 = 0, b11 = 0, bn = 0, bnum = 0;


    const startBtn = document.getElementById('start-btn');
    const questionText = document.getElementById('question-text');
    const activityBox = document.getElementById('my-activity');


        function addTextToActivityBox(text, x, y, fontSize = 28) {
      const txt = document.createElement('div');
      txt.classList.add('activity-text');
      txt.textContent = text;
      txt.style.left = `${x}px`;
      txt.style.top = `${y}px`;
      txt.style.fontSize = `${fontSize}px`;
      activityBox.appendChild(txt);
    }


    // --- Utilities ---
    function isPrime(n) {
      if (n < 2) return false;
      if (n % 2 === 0) return n === 2;
      const r = Math.floor(Math.sqrt(n));
      for (let d = 3; d <= r; d += 2) if (n % d === 0) return false;
      return true;
    }
    
    function primeFactorCount(n) {
      // counts with multiplicity, e.g., 12 = 2^2 * 3 => 3
      let count = 0, m = n;
      for (let p = 2; p * p <= m; p += (p === 2 ? 1 : 2)) {
        while (m % p === 0) { count++; m = Math.trunc(m / p); }
      }
      if (m > 1) count++;
      return count;
    }
    
    // Center a flexible-width box at an x center and y top
    function placeCentered(el, centerX, topY) {
      el.style.left = `${centerX}px`;
      el.style.top = `${topY}px`;
      el.style.position = 'absolute';
      el.style.transform = 'translateX(-50%)';
    }
    
    // Draw a line on the canvas between two DOM elements (box centers, bottom-to-top)
    function connectBoxes(ctx, parentEl, childEl) {
      const p = parentEl.getBoundingClientRect();
      const c = childEl.getBoundingClientRect();
      const canvasRect = ctx.canvas.getBoundingClientRect();
    
      const parentCenterX = p.left + p.width / 2 - canvasRect.left;
      const parentBottomY = p.top + p.height - canvasRect.top;
    
      const childCenterX = c.left + c.width / 2 - canvasRect.left;
      const childTopY = c.top - canvasRect.top;
    
      ctx.strokeStyle = 'black';
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(parentCenterX, parentBottomY);
      ctx.lineTo(childCenterX, childTopY);
      ctx.stroke();
    }


    function createNumberLeaf({
      value, centerX, topY, totalAnum,
      segmentLeft, segmentRight, ctx,
      totalWidth = 1300,  // NEW default
      boxHeight = 80      // NEW default
    }) {
      const isP = isPrime(value);
      const box = document.createElement('div');
      box.className = isP ? 'prime-box' : 'composite-box';
      box.textContent = value.toString();
      activityBox.appendChild(box);
      placeCentered(box, centerX, topY);
    
      if (isP) return { box, value, leaf: true };
    
      const controls = document.createElement('div');
      controls.className = 'leaf-controls';
      placeCentered(controls, centerX, topY + boxHeight + 8); // was +88; now uses boxHeight
      const input = document.createElement('input');
      input.type = 'number';
      input.placeholder = 'Enter divisor';
      input.min = '2';
      input.step = '1';
    
      const tryBtn = document.createElement('button');
      tryBtn.className = 'rubber-button';
      tryBtn.textContent = 'Try Divisor';
    
      controls.appendChild(input);
      controls.appendChild(tryBtn);
      activityBox.appendChild(controls);
    
      tryBtn.addEventListener('click', () => {
        const c = parseInt(input.value, 10);
        if (!c || c < 2) return;
        if (value % c !== 0) return;
    
        const d = value / c;
    
        const cnum = primeFactorCount(c);
        const dnum = primeFactorCount(d);
    
        // totalWidth is now passed in (650 for each side)
        const leftWidth = totalWidth * (cnum / totalAnum);
        const rightWidth = totalWidth * (dnum / totalAnum);
    
        const leftCenter = (segmentLeft ?? 0) + leftWidth / 2;
        const rightCenter = (segmentRight ?? totalWidth) - rightWidth / 2;
    
        controls.remove();
    
        const childTop = topY + 110; // increased vertical spacing between generations
    
        const leftChild = createNumberLeaf({
          value: c,
          centerX: leftCenter,
          topY: childTop,
          totalAnum,
          segmentLeft: (segmentLeft ?? 0),
          segmentRight: (segmentLeft ?? 0) + leftWidth,
          ctx,
          totalWidth,             // pass through 650
          boxHeight               // pass through 64
        });
    
        const rightChild = createNumberLeaf({
          value: d,
          centerX: rightCenter,
          topY: childTop,
          totalAnum,
          segmentLeft: (segmentRight ?? totalWidth) - rightWidth,
          segmentRight: (segmentRight ?? totalWidth),
          ctx,
          totalWidth,             // pass through 650
          boxHeight               // pass through 64
        });
    
        connectBoxes(ctx, box, leftChild.box);
        connectBoxes(ctx, box, rightChild.box);
        maybeRenderExponentStage(a, b);
      });
    
      return { box, value, leaf: false };
    }


    
    // Return Map<prime, exponent>
    function factorMap(n) {
      const map = new Map();
      let m = n;
      for (let p = 2; p * p <= m; p += (p === 2 ? 1 : 2)) {
        while (m % p === 0) { map.set(p, (map.get(p) || 0) + 1); m = Math.trunc(m / p); }
      }
      if (m > 1) map.set(m, (map.get(m) || 0) + 1);
      return map;
    }
    
    // Build a “result product” row (for gcd / lcm) with empty superscripts to fill later
    function buildResultRow(label, primesUnion) {
      const wrap = document.createElement('div');
      wrap.className = 'exp-result';
    
      const lbl = document.createElement('span');
      lbl.style.fontWeight = '700';
      lbl.textContent = `${label} =`;
      wrap.appendChild(lbl);
    
      primesUnion.forEach((p, idx) => {
        if (idx > 0) {
          const times = document.createElement('span');
          times.className = 'exp-times';
          times.textContent = '×';
          wrap.appendChild(times);
        }
        const term = document.createElement('span');
        term.className = 'exp-term';
    
        const baseSpan = document.createElement('span');
        baseSpan.textContent = p.toString();
        term.appendChild(baseSpan);
    
        // empty superscript container; we’ll fill it later
        const sup = document.createElement('span');
        sup.className = 'exp-sup';
        sup.dataset.prime = String(p);
        term.appendChild(sup);
    
        wrap.appendChild(term);
      });
    
      return wrap;
    }
    
    // Called when both trees are fully factored; renders inputs + gcd/lcm shells
    function maybeRenderExponentStage(aVal, bVal) {
      if (activityBox.querySelectorAll('.leaf-controls').length > 0) return;
    
      const fa = factorMap(aVal);
      const fb = factorMap(bVal);
      const primesUnion = Array.from(new Set([...fa.keys(), ...fb.keys()])).sort((x, y) => x - y);
    
      // Insert prompt
      const q2 = document.createElement('p');
      q2.textContent = 'Fill in the exponents in the prime factorizations.  Observe the gcd takes the maximums of the exponents, and the lcm takes the minimums.';
      activityBox.parentElement.appendChild(q2);
      q2.style.textAlign = 'center';
      q2.style.fontWeight = 'bold';

    
      // SECOND activity: short box, two lines (a with gcd on right; b with lcm on right)
      const box2 = document.createElement('div');
      box2.className = 'activity-box-short';
      box2.id = 'exponent-activity';
      box2.style.marginTop = '10px';
      activityBox.parentElement.appendChild(box2);
    
      // state: track correct entries per base for a and b
      const filledA = new Map(); // prime -> exponent (once correct)
      const filledB = new Map();
    
      // ---------- left interactive row builders ----------
      const makeInteractiveRow = (label, fmSelf, fmOther, onFilled) => {
        const row = document.createElement('div');
        row.className = 'exp-row';
        const lbl = document.createElement('span');
        lbl.style.fontWeight = '700';
        lbl.textContent = `${label} =`;
        row.appendChild(lbl);
    
        primesUnion.forEach((p, idx) => {
          if (idx > 0) {
            const times = document.createElement('span');
            times.className = 'exp-times';
            times.textContent = '×';
            row.appendChild(times);
          }
    
          const term = document.createElement('span');
          term.className = 'exp-term';
    
          const baseSpan = document.createElement('span');
          baseSpan.textContent = p.toString();
          term.appendChild(baseSpan);
    
          const sup = document.createElement('span');
          sup.className = 'exp-sup';
    
          const correct = fmSelf.get(p) || 0;
    
          const input = document.createElement('input');
          input.type = 'number';
          input.className = 'exp-input';
          input.min = '0'; input.step = '1'; input.placeholder = '…';
    
          input.addEventListener('change', () => {
            const val = Number(input.value);
            if (!Number.isInteger(val) || val < 0) return;
            if (val !== correct) return;
    
            // replace with colored box (min/max/equal relative to the OTHER number)
            const other = fmOther.get(p) || 0;
            const box = document.createElement('span');
            box.className = 'expo-box';
            if (correct === other) box.classList.add('equal');
            else if (correct < other) box.classList.add('min');
            else box.classList.add('max');
            box.textContent = String(correct);
            sup.replaceChild(box, input);
    
            // record filled and notify
            onFilled(p, correct);
          });
    
          sup.appendChild(input);
          term.appendChild(sup);
          row.appendChild(term);
        });
    
        return row;
      };
    
      // ---------- right result rows ----------
      // Per your request (note: this intentionally follows your spec, even though it
      // swaps the usual gcd/lcm exponent rules):
      // - gcd row shows the GREEN MAX when both exponents entered
      // - lcm row shows the RED MIN when both exponents entered
      const gcdRow = buildResultRow('gcd(a, b)', primesUnion);
      const lcmRow = buildResultRow('lcm(a, b)', primesUnion);
    
      // Create a 2×2 grid layout: (a | b) on top, (gcd | lcm) below
      const grid = document.createElement('div');
      grid.style.display = 'grid';
      grid.style.gridTemplateColumns = '1fr 1fr';
      grid.style.rowGap = '20px';
      grid.style.columnGap = '40px';
      grid.style.justifyItems = 'center';
      grid.style.alignItems = 'start';
      grid.style.marginTop = '20px';
      
      // Row 1: a and b
      const topLeft = document.createElement('div');
      topLeft.appendChild(rowA);
      
      const topRight = document.createElement('div');
      topRight.appendChild(rowB);
      
      // Row 2: gcd and lcm
      const bottomLeft = document.createElement('div');
      bottomLeft.appendChild(gcdRow);
      
      const bottomRight = document.createElement('div');
      bottomRight.appendChild(lcmRow);
      
      // Add all to grid
      grid.appendChild(topLeft);
      grid.appendChild(topRight);
      grid.appendChild(bottomLeft);
      grid.appendChild(bottomRight);
      
      box2.appendChild(grid);

    
      // add to box
      box2.appendChild(lineA);
      box2.appendChild(lineB);
      // shift the b/lcm row down slightly
      lineB.style.marginTop = '40px';

    }



    

    
  startBtn.addEventListener('click', () => {

    const feedback = document.getElementById('feedbackText');
    feedback.textContent = '';


    let question = `Find the prime factorizations of `;

    let primes = [13, 17, 19, 23, 29, 31, 37, 41, 43, 47];
    a2 = 20;
    b2 = 20;
  
    // Randomly determine prime powers
    while ((a2 + a3 + a5 + a7 + a11 + an) > 7 || (a2 + a3 + a5 + a7 + a11 + an) < 4) {
      a2 = Math.floor(Math.random() * 4.75);
      a3 = Math.floor(Math.random() * 3.5);
      a5 = Math.floor(Math.random() * 2.75);
      a7 = Math.floor(Math.random() * 1.75);
      a11 = Math.floor(Math.random() * 1.5);
      an = Math.floor(Math.random() * 1.5);
    }

    antype = primes[Math.floor(Math.random() * 10)];

    a = 2**a2 * 3**a3 * 5**a5 * 7**a7 * 11**a11 * antype**an;
    anum = a2 + a3 + a5 + a7 + a11 + an;
    
    while ((b2 + b3 + b5 + b7 + b11 + bn) > 7 || (b2 + b3 + b5 + b7 + b11 + bn) < 4) {
      b2 = Math.floor(Math.random() * 4.75);
      b3 = Math.floor(Math.random() * 3.5);
      b5 = Math.floor(Math.random() * 2.75);
      b7 = Math.floor(Math.random() * 1.75);
      b11 = Math.floor(Math.random() * 1.5);
      bn = Math.floor(Math.random() * 1.5);
    }

    bntype = primes[Math.floor(Math.random() * 10)];

    b = 2**b2 * 3**b3 * 5**b5 * 7**b7 * 11**b11 * bntype**bn;
    bnum = b2 + b3 + b5 + b7 + b11 + bn;
  
    console.log(`a powers: ${a2}, ${a3}, ${a5}, ${a7}, ${a11}, ${an} and a mystery prime: ${antype}`);
    console.log(`b powers: ${b2}, ${b3}, ${b5}, ${b7}, ${b11}, ${bn} and b mystery prime: ${bntype}`);

    // Display the question
    questionText.textContent = question + `the numbers ${a} and ${b}.  Input divisors of each number to break them down into primes.`;

    MathJax.typeset([questionText]);

    // Remove a prior exponent stage (if user restarts)
    const oldQ2 = document.querySelector('#exponent-activity')?.previousElementSibling;
    if (document.getElementById('exponent-activity')) {
      document.getElementById('exponent-activity').remove();
      if (oldQ2 && oldQ2.tagName === 'P' && oldQ2.textContent.startsWith('Fill in the exponents')) {
        oldQ2.remove();
      }
    }

    // Clear the activity box
    activityBox.innerHTML = '';
    
    // Enable compact mode for side-by-side
    activityBox.classList.add('compact');
    
    // Create a canvas
    const canvas = document.createElement('canvas');
    canvas.width = 1300;
    canvas.height = 750;
    activityBox.appendChild(canvas);
    
    const ctx = canvas.getContext('2d');
    ctx.strokeStyle = 'black';
    ctx.lineWidth = 4;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Layout constants for side-by-side trees
    const halfWidth = 650;
    const boxH = 60;         // compact box height
    const topY = 12;         // a bit tighter top padding
    
    // --- LEFT: a ---
    const aCenterX = 325;    // center of left 0..650
    createNumberLeaf({
      value: a,
      centerX: aCenterX,
      topY,
      totalAnum: anum,
      segmentLeft: 0,
      segmentRight: halfWidth,
      ctx,
      totalWidth: halfWidth,
      boxHeight: boxH
    });
    
    // --- RIGHT: b ---
    const bCenterX = 650 + 325; // 975, center of right 650..1300
    createNumberLeaf({
      value: b,
      centerX: bCenterX,
      topY,
      totalAnum: bnum,
      segmentLeft: halfWidth,
      segmentRight: 1300,
      ctx,
      totalWidth: halfWidth,
      boxHeight: boxH
    });



  });

    const feedbackText = document.getElementById('feedbackText');
    
  </script>

  <audio id="click-sound" src="button.mp3" preload="auto"></audio>
  <audio id="set-sound" src="set2.mp3" preload="auto"></audio>
  
</body>
</html>
