
<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="description" content="Personal website of Ben Fraser, with math education activities for students and teachers.">
  <meta charset="UTF-8" />
  <title>Prime Factorization Activity</title>
  <link rel="stylesheet" href="/style.css" />

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
</head>
<body>
  <header>
    <h1>Prime Factorization Activity</h1>
    <div id="nav-placeholder"></div>
      <script>
fetch("/nav.html")
  .then(response => response.text())
  .then(html => {
    document.getElementById("nav-placeholder").innerHTML = html;

    const currentPath = window.location.pathname.replace(/\/index\.html$/, "/");
    const navLinks = document.querySelectorAll("#nav-placeholder a");
    navLinks.forEach(link => {
      const linkPath = new URL(link.href).pathname.replace(/\/index\.html$/, "/");
      if (linkPath === currentPath) {
        link.classList.add("active");
      }
    });

    const s = document.createElement("script");
    s.src = "/mascot.js";
    s.defer = true;
    document.body.appendChild(s); 
  })
  .catch(err => {
    console.error("Failed to load nav:", err);
  });
</script>
  </header>
  <main>

    <p>This is a placeholder for what will be a prime factorization activity.  Work in progress.</p>
    
    <div class="button-container">
      <button id="start-btn" class="rubber-button">Start!</button>
    </div>
    
    <p id="question-text"></p>

    <div class="activity-box" id="my-activity">

    </div>
    
    <div class="button-container">
      <div id="feedbackText" class="center-feedback"></div>
    </div>

  </main>

  <script>


    let a = 0, a2 = 0, a3 = 0, a5 = 0, a7 = 0, a11 = 0, an = 0, anum = 0;
    let b = 0, b2 = 0, b3 = 0, b5 = 0, b7 = 0, b11 = 0, bn = 0, bnum = 0;


    const startBtn = document.getElementById('start-btn');
    const questionText = document.getElementById('question-text');
    const activityBox = document.getElementById('my-activity');


        function addTextToActivityBox(text, x, y, fontSize = 28) {
      const txt = document.createElement('div');
      txt.classList.add('activity-text');
      txt.textContent = text;
      txt.style.left = `${x}px`;
      txt.style.top = `${y}px`;
      txt.style.fontSize = `${fontSize}px`;
      activityBox.appendChild(txt);
    }


    function createFixedExponentBox(text, x, y, boxSize = 80, fontSize = 28) {
      const box = document.createElement('div');
      box.classList.add('exponent-box');
      box.style.left = `${x}px`;
      box.style.top = `${y}px`;
      box.style.width = `${boxSize}px`;
      box.style.height = `${boxSize}px`;
      box.style.fontSize = `${fontSize}px`;
      box.textContent = text;
      activityBox.appendChild(box);
      return box;
    }

    // --- Utilities ---
    function isPrime(n) {
      if (n < 2) return false;
      if (n % 2 === 0) return n === 2;
      const r = Math.floor(Math.sqrt(n));
      for (let d = 3; d <= r; d += 2) if (n % d === 0) return false;
      return true;
    }
    
    function primeFactorCount(n) {
      // counts with multiplicity, e.g., 12 = 2^2 * 3 => 3
      let count = 0, m = n;
      for (let p = 2; p * p <= m; p += (p === 2 ? 1 : 2)) {
        while (m % p === 0) { count++; m = Math.trunc(m / p); }
      }
      if (m > 1) count++;
      return count;
    }
    
    // Center a flexible-width box at an x center and y top
    function placeCentered(el, centerX, topY) {
      el.style.left = `${centerX}px`;
      el.style.top = `${topY}px`;
      el.style.position = 'absolute';
      el.style.transform = 'translateX(-50%)';
    }
    
    // Draw a line on the canvas between two DOM elements (box centers, bottom-to-top)
    function connectBoxes(ctx, parentEl, childEl) {
      const p = parentEl.getBoundingClientRect();
      const c = childEl.getBoundingClientRect();
      const canvasRect = ctx.canvas.getBoundingClientRect();
    
      const parentCenterX = p.left + p.width / 2 - canvasRect.left;
      const parentBottomY = p.top + p.height - canvasRect.top;
    
      const childCenterX = c.left + c.width / 2 - canvasRect.left;
      const childTopY = c.top - canvasRect.top;
    
      ctx.strokeStyle = 'black';
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(parentCenterX, parentBottomY);
      ctx.lineTo(childCenterX, childTopY);
      ctx.stroke();
    }


    // Create a prime/composite box + (if composite) input controls
    function createNumberLeaf({
      value, centerX, topY, totalAnum, segmentLeft, segmentRight, ctx
    }) {
      const isP = isPrime(value);
      const box = document.createElement('div');
      box.className = isP ? 'prime-box' : 'composite-box';
      box.textContent = value.toString();
      activityBox.appendChild(box);
      placeCentered(box, centerX, topY);
    
      // If prime, no controls — return the box only.
      if (isP) return { box, value, leaf: true };
    
      // Otherwise, add controls to try a divisor.
      const controls = document.createElement('div');
      controls.className = 'leaf-controls';
      placeCentered(controls, centerX, topY + 88); // 8px below the 80px box
      const input = document.createElement('input');
      input.type = 'number';
      input.placeholder = 'Enter divisor';
      input.min = '2';
      input.step = '1';
    
      const tryBtn = document.createElement('button');
      tryBtn.className = 'rubber-button';
      tryBtn.textContent = 'Try Divisor';
    
      controls.appendChild(input);
      controls.appendChild(tryBtn);
      activityBox.appendChild(controls);
    
      // Click handler for factor attempt on THIS leaf only.
      tryBtn.addEventListener('click', () => {
        const c = parseInt(input.value, 10);
        if (!c || c < 2) return;
        if (value % c !== 0) return; // do nothing if not a divisor
    
        const d = value / c;
        // Compute factor counts
        const cnum = primeFactorCount(c);
        const dnum = primeFactorCount(d);
    
        // Reserve horizontal widths based on the ORIGINAL anum
        const totalWidth = 1300;
        const leftWidth = totalWidth * (cnum / totalAnum);
        const rightWidth = totalWidth * (dnum / totalAnum);
    
        // Determine child centers inside their respective segments
        const leftCenter = (segmentLeft ?? 0) + leftWidth / 2;
        const rightCenter = (segmentRight ?? totalWidth) - rightWidth / 2;
    
        // Remove this node’s controls
        controls.remove();
    
        // Create left (c) and right (d) children 80px lower
        const childTop = topY + 80;
    
        const leftChild = createNumberLeaf({
          value: c,
          centerX: leftCenter,
          topY: childTop,
          totalAnum,
          segmentLeft: (segmentLeft ?? 0),
          segmentRight: (segmentLeft ?? 0) + leftWidth,
          ctx
        });
    
        const rightChild = createNumberLeaf({
          value: d,
          centerX: rightCenter,
          topY: childTop,
          totalAnum,
          segmentLeft: (segmentRight ?? totalWidth) - rightWidth,
          segmentRight: (segmentRight ?? totalWidth),
          ctx
        });
    
        // Draw connectors
        connectBoxes(ctx, box, leftChild.box);
        connectBoxes(ctx, box, rightChild.box);
      });
    
      return { box, value, leaf: false };
    }


    

    
  startBtn.addEventListener('click', () => {

    const feedback = document.getElementById('feedbackText');
    feedback.textContent = '';


    let question = `Do some math:`;

    let primes = [13, 17, 19, 23, 29, 31, 37, 41, 43, 47];
    a2 = 20;
    b2 = 20;
  
    // Randomly determine prime powers
    while ((a2 + a3 + a5 + a7 + a11 + an) > 7 || (a2 + a3 + a5 + a7 + a11 + an) < 4) {
      a2 = Math.floor(Math.random() * 4.75);
      a3 = Math.floor(Math.random() * 3.5);
      a5 = Math.floor(Math.random() * 2.75);
      a7 = Math.floor(Math.random() * 1.75);
      a11 = Math.floor(Math.random() * 1.5);
      an = Math.floor(Math.random() * 1.5);
    }

    antype = primes[Math.floor(Math.random() * 10)];

    a = 2**a2 * 3**a3 * 5**a5 * 7**a7 * 11**a11 * antype**an;
    anum = a2 + a3 + a5 + a7 + a11 + an;
    
    while ((b2 + b3 + b5 + b7 + b11 + bn) > 7 || (b2 + b3 + b5 + b7 + b11 + bn) < 4) {
      b2 = Math.floor(Math.random() * 4.75);
      b3 = Math.floor(Math.random() * 3.5);
      b5 = Math.floor(Math.random() * 2.75);
      b7 = Math.floor(Math.random() * 1.75);
      b11 = Math.floor(Math.random() * 1.5);
      bn = Math.floor(Math.random() * 1.5);
    }

    bntype = primes[Math.floor(Math.random() * 10)];

    b = 2**b2 * 3**b3 * 5**b5 * 7**b7 * 11**b11 * bntype**bn;
    bnum = b2 + b3 + b5 + b7 + b11 + bn;
  
    console.log(`a powers: ${a2}, ${a3}, ${a5}, ${a7}, ${a11}, ${an} and a mystery prime: ${antype}`);
    console.log(`b powers: ${b2}, ${b3}, ${b5}, ${b7}, ${b11}, ${bn} and b mystery prime: ${bntype}`);

    // Display the question
    questionText.textContent = question + ` with the numbers ${a} and ${b}.`;

    MathJax.typeset([questionText]);

    
    // Clear the activity box
    activityBox.innerHTML = '';
    
    // Create a canvas
    const canvas = document.createElement('canvas');
    canvas.width = 1300;
    canvas.height = 650;
    activityBox.appendChild(canvas);
    
    const ctx = canvas.getContext('2d');
    
    ctx.strokeStyle = 'black';
    ctx.lineWidth = 4;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // 1) Place 'a' at the top center in a composite box (it will be prime-colored if a happens to be prime)
    const topCenterX = 650; // 1300 / 2
    const topY = 20;
    
    // total prime factor count of ORIGINAL 'a' (already computed in your code as 'anum')
    const root = createNumberLeaf({
      value: a,
      centerX: topCenterX,
      topY: topY,
      totalAnum: anum,
      // Root owns the full 0..1300 segment
      segmentLeft: 0,
      segmentRight: 1300,
      ctx
    });


  });

    const feedbackText = document.getElementById('feedbackText');
    
  </script>

  <audio id="click-sound" src="button.mp3" preload="auto"></audio>
  <audio id="set-sound" src="set2.mp3" preload="auto"></audio>
  
</body>
</html>
