<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Subtraction Activity 1</title>
  <link rel="stylesheet" href="/math-tools/style.css" />
</head>
<body>
  <header>
    <h1>Subtraction Activity 1</h1>
    <div id="nav-placeholder"></div>
      <script>
        fetch("/math-tools/nav.html")
          .then(response => response.text())
          .then(data => {
            document.getElementById("nav-placeholder").innerHTML = data;
        
            const currentPath = window.location.pathname.replace(/\/index\.html$/, "/");
            const navLinks = document.querySelectorAll("#nav-placeholder a");
        
            navLinks.forEach(link => {
              const linkPath = new URL(link.href).pathname.replace(/\/index\.html$/, "/");
              if (linkPath === currentPath) {
                link.classList.add("active");
              }
            });
          });
      </script>
  </header>
  <main>

    <div class="button-container">
      <button id="start-btn" class="rubber-button">Start!</button>
    </div>
    
    <p id="question-text"></p>

    <div class="activity-box" id="my-activity">

    </div>



  </main>
  <script>
    const startBtn = document.getElementById('start-btn');
    const questionText = document.getElementById('question-text');
    const activityBox = document.getElementById('my-activity');

    function createColumn({ label, idPrefix, left, top, hasRegroup = true }) {
      const column = document.createElement('div');
      column.classList.add('column');
      column.style.left = `${left}px`;
      column.style.top = `${top}px`;
    
      const labelDiv = document.createElement('div');
      labelDiv.classList.add('column-label');
      labelDiv.textContent = label;
      column.appendChild(labelDiv);

      if (hasRegroup) {
        const regroup = document.createElement('div');
        regroup.classList.add('regroup-zone');
      
        // Add specific class based on place value
        if (label.toLowerCase() === 'subtrahend-tens' || label.toLowerCase() === 'difference-tens') {
          regroup.classList.add('regroup-tens');
        } else if (label.toLowerCase() === 'subtrahend-ones' || label.toLowerCase() === 'difference-ones') {
          regroup.classList.add('regroup-ones');
        }
      
        regroup.textContent = '⇆';
        column.appendChild(regroup);
      }

    
      const stack = document.createElement('div');
      stack.classList.add('block-stack');
      stack.id = `${idPrefix}-stack`;
      column.appendChild(stack);
    
      const count = document.createElement('div');
      count.classList.add('block-count');
      count.id = `${idPrefix}-count`;
      count.textContent = '0';
      column.appendChild(count);
    
      return column;
    }

    function addTextToActivityBox(text, x, y) {
      const txt = document.createElement('div');
      txt.classList.add('activity-text');
      txt.textContent = text;
      txt.style.left = `${x}px`;
      txt.style.top = `${y}px`;
      activityBox.appendChild(txt);
    }

    function makeDraggable(element) {
      let offsetX, offsetY;
      let isDragging = false;
    
      element.addEventListener('mousedown', (e) => {
        isDragging = true;
        offsetX = e.offsetX;
        offsetY = e.offsetY;
        element.style.zIndex = 1000;
        element.style.cursor = 'grabbing';
      });
    
      document.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        const parentRect = activityBox.getBoundingClientRect();
        element.style.left = `${e.clientX - parentRect.left - offsetX}px`;
        element.style.top = `${e.clientY - parentRect.top - offsetY}px`;
      });
    
      document.addEventListener('mouseup', () => {
        isDragging = false;
        element.style.cursor = 'grab';
      });
    }


  
    startBtn.addEventListener('click', () => {
      // Generate two numbers between 1 and 200
      let a = Math.floor(Math.random() * 200) + 1;
      let b = Math.floor(Math.random() * 200) + 1;
  
      if (b > a) [a, b] = [b, a]; // ensure a ≥ b
  
      // Display the question
      questionText.textContent = `What is ${a} − ${b}?  Remember that each place value column should contain between 0 and 9 blocks at the end!`;

      
      // Clear the activity box
      activityBox.innerHTML = '';

      addTextToActivityBox("Starting Amount (Minuend)", 105, 10);

      const minuendHundredsColumn = createColumn({
        label: "Hundreds",
        idPrefix: "minuend-hundreds",
        left: 25,
        top: 50,
        hasRegroup: false
      });

      const minuendTensColumn = createColumn({
        label: "Tens",
        idPrefix: "minuend-tens",
        left: 155,
        top: 50,
        hasRegroup: false
      });

      const minuendOnesColumn = createColumn({
        label: "Ones",
        idPrefix: "minuend-ones",
        left: 285,
        top: 50,
        hasRegroup: false
      });

      addTextToActivityBox("Take Away/Minus (Subtrahend)", 510, 10);
      addTextToActivityBox("-", 430, 320);

      const subtrahendHundredsColumn = createColumn({
        label: "Hundreds",
        idPrefix: "subtrahend-hundreds",
        left: 450,
        top: 50,
        hasRegroup: false
      });

      const subtrahendTensColumn = createColumn({
        label: "Tens",
        idPrefix: "subtrahend-tens",
        left: 580,
        top: 50,
      });

      const subtrahendOnesColumn = createColumn({
        label: "Ones",
        idPrefix: "subtrahend-ones",
        left: 710,
        top: 50,
      });

      addTextToActivityBox("Result/Answer (Difference)", 955, 10);
      addTextToActivityBox("=", 855, 320);

      const differenceHundredsColumn = createColumn({
        label: "Hundreds",
        idPrefix: "difference-hundreds",
        left: 875,
        top: 50,
        hasRegroup: false
      });

      const differenceTensColumn = createColumn({
        label: "Tens",
        idPrefix: "difference-tens",
        left: 1005,
        top: 50,
      });

      const differenceOnesColumn = createColumn({
        label: "Ones",
        idPrefix: "difference-ones",
        left: 1135,
        top: 50,
      });

      activityBox.appendChild(minuendHundredsColumn);
      activityBox.appendChild(minuendTensColumn);
      activityBox.appendChild(minuendOnesColumn);
      activityBox.appendChild(subtrahendHundredsColumn);
      activityBox.appendChild(subtrahendTensColumn);
      activityBox.appendChild(subtrahendOnesColumn);
      activityBox.appendChild(differenceHundredsColumn);
      activityBox.appendChild(differenceTensColumn);
      activityBox.appendChild(differenceOnesColumn);

      function createDraggableBlock(x, y, type = 'ones') {
        const block = document.createElement('div');
        block.classList.add('draggable-block', `block-${type}`);
        block.style.left = `${x}px`;
        block.style.top = `${y}px`;
        activityBox.appendChild(block);
        makeDraggable(block);
      }

      
      createDraggableBlock(100, 100, 'ones');
      createDraggableBlock(200, 120, 'tens');
      createDraggableBlock(300, 140, 'hundreds');


    });
  </script>

</body>
</html>
