<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="description" content="Personal website of Ben Fraser, with math education activities for students and teachers.">
  <meta charset="UTF-8" />
  <title>Exponents and Radicals Activity</title>
  <link rel="stylesheet" href="/style.css" />

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
</head>
<body>
  <header>
    <h1>Exponents and Radicals Activity</h1>
    <div id="nav-placeholder"></div>
      <script>
fetch("/nav.html")
  .then(response => response.text())
  .then(html => {
    document.getElementById("nav-placeholder").innerHTML = html;

    const currentPath = window.location.pathname.replace(/\/index\.html$/, "/");
    const navLinks = document.querySelectorAll("#nav-placeholder a");
    navLinks.forEach(link => {
      const linkPath = new URL(link.href).pathname.replace(/\/index\.html$/, "/");
      if (linkPath === currentPath) {
        link.classList.add("active");
      }
    });

    const s = document.createElement("script");
    s.src = "/mascot.js";
    s.defer = true;
    document.body.appendChild(s); 
  })
  .catch(err => {
    console.error("Failed to load nav:", err);
  });
</script>
  </header>
  <main>

    <p>In much the same way that multiplication is defined by repeated addition:
      \[3 \cdot 5 = 3 + 3 + 3 + 3 + 3\]
      exponentiation is defined by repeated multiplication:
      \[2^4 = 2 \cdot 2 \cdot 2 \cdot 2\]
      Using this definition, it is possible to derive the following exponent laws, for any real numbers \(a, b, m, n\) (provided they don't result in 
      denominators of zero):
    </p>

    <ul>
      <li>\(a^0 = 1\)</li>
      <li>\(a^m \cdot a^n = a^{m+n}\)</li>
      <li>\(\frac{a^m}{a^n} = a^{m-n}\)</li>
      <li>\((a^m)^n = a^{mn}\)</li>
      <li>\(a^{-n} = \frac{1}{a^n}\)</li>
      <li>\(a^{\frac{m}{n}} = (a^m)^{\frac{1}{n}} = \left(a^{\frac{1}{n}}\right)^m\)</li>
      <li>\((ab)^n = a^n \cdot b^n\)</li>
      <li>\(\left(\frac{a}{b}\right)^n = \frac{a^n}{b^n}\)</li>
    </ul>
    
    <p>In the above, the only exponent that it is unclear how to perform the computation with is the fractional exponent.  These can also be represented 
      with a radical symbol:
      \[a^{\frac{1}{n}} = \sqrt[n]{a}\]
      To evaluate a radical, we use the following definition:
      \[\sqrt[n]{a} = x \iff a = x^n\]
      That is, to take the \(n^{\text{th}}\) power of \(a\), we are looking for a number \(x\), which when raised to the \(n^{\text{th}}\) power, gives 
      \(a\).
    </p>


    

    <div class="button-container">
      <button id="start-btn" class="rubber-button">Start!</button>
    </div>
    
    <p id="question-text" class="math"></p>

    <div id="activity-ui" style="margin-top: 1.2em; text-align: center;">
      <div id="answer-area" style="display:none; margin-top: 0.5em;"></div>
      <div class="button-container" style="margin-top: 0.6em;">
        <button id="hint-btn" class="rubber-button" style="display:none;">Hint</button>
        <button id="check-btn" class="rubber-button" style="display:none; margin-left: 0.5em;">Check Answer</button>
      </div>
      <p id="feedback" style="font-weight: bold; margin-top: 0.6em;"></p>
      <div id="hint-area" class="math" style="margin-top: 1em;"></div>
    </div>

</main>
<script>
// -----------------------------
// Systems of Equations Activity
// (question generation + hints + answer input)
// -----------------------------
const startBtn = document.getElementById('start-btn');
const questionText = document.getElementById('question-text');

const hintBtn = document.getElementById('hint-btn');
const checkBtn = document.getElementById('check-btn');
const answerArea = document.getElementById('answer-area');
const feedback = document.getElementById('feedback');
const hintArea = document.getElementById('hint-area');

let hintSteps = [];
let hintIndex = 0;

// The current problem data lives here.
let current = null;

function playSound(id) {
  const s = document.getElementById(id);
  if (s) { s.currentTime = 0; s.play(); }
}

function randInt(a, b) {
  return Math.floor(Math.random() * (b - a + 1)) + a;
}

function choice(arr) {
  return arr[randInt(0, arr.length - 1)];
}

function gcd(a, b) {
  a = Math.abs(a); b = Math.abs(b);
  while (b !== 0) { const t = a % b; a = b; b = t; }
  return a === 0 ? 1 : a;
}

function reduceFrac(num, den) {
  if (den < 0) { den = -den; num = -num; }
  const g = gcd(num, den);
  return [num / g, den / g];
}

function fracToTex(num, den) {
  const [n, d] = reduceFrac(num, den);
  if (d === 1) return `${n}`;
  return `\\frac{${n}}{${d}}`;
}

// ---- parsing helpers ----
function parseExactRational(raw) {
  // Accept integer, fraction a/b, or terminating decimal.
  // Returns { ok:true, num, den } reduced, or { ok:false, msg }
  if (raw == null) return { ok:false, msg:'Please enter an answer.' };
  const s0 = raw.trim();
  if (!s0) return { ok:false, msg:'Please enter an answer.' };

  // allow leading +/-, remove spaces
  const s = s0.replace(/\s+/g, '');

  // fraction
  const fm = s.match(/^([+-]?\d+)\/([+-]?\d+)$/);
  if (fm) {
    const a = parseInt(fm[1], 10);
    const b = parseInt(fm[2], 10);
    if (b === 0) return { ok:false, msg:'Denominator cannot be 0.' };
    const [n, d] = reduceFrac(a, b);
    return { ok:true, num:n, den:d };
  }

  // integer
  if (/^[+-]?\d+$/.test(s)) {
    const a = parseInt(s, 10);
    return { ok:true, num:a, den:1 };
  }

  // terminating decimal: optional leading digits then . digits
  const dm = s.match(/^([+-]?)(\d*)\.(\d+)$/);
  if (dm) {
    const sign = dm[1] === '-' ? -1 : 1;
    const intPart = dm[2] ? parseInt(dm[2], 10) : 0;
    const fracPartStr = dm[3];
    // exact fraction from base-10 expansion
    const k = fracPartStr.length;
    const den = Math.pow(10, k);
    const fracPart = parseInt(fracPartStr, 10);
    const num = sign * (intPart * den + fracPart);
    const [n, d] = reduceFrac(num, den);
    return { ok:true, num:n, den:d };
  }

  return { ok:false, msg:'Use an integer, a fraction like 3/7, or a terminating decimal like 2.5.' };
}

function parseMoneyToCents(raw) {
  // Accept: 42, 42.5, 42.50, $1,200.50
  // Returns { ok:true, cents } or { ok:false, msg }
  if (raw == null) return { ok:false, msg:'Please enter an answer.' };
  let s = raw.trim();
  if (!s) return { ok:false, msg:'Please enter an answer.' };

  s = s.replace(/\$/g, '').replace(/,/g, '').replace(/\s+/g, '');

  // integer dollars
  if (/^[+-]?\d+$/.test(s)) {
    const dollars = parseInt(s, 10);
    return { ok:true, cents: dollars * 100 };
  }

  // dollars.cents (1 or 2 decimal digits)
  const m = s.match(/^([+-]?\d+)\.(\d{1,2})$/);
  if (m) {
    const dollars = parseInt(m[1], 10);
    const cents = parseInt(m[2].padEnd(2, '0'), 10);
    const sign = dollars < 0 ? -1 : 1;
    return { ok:true, cents: dollars * 100 + sign * cents };
  }

  return { ok:false, msg:'Enter a dollar amount like 42, 42.50, or 1,200.50.' };
}

function moneyFromCents(cents) {
  const sign = cents < 0 ? "-" : "";
  cents = Math.abs(Math.round(cents));
  const dollars = Math.floor(cents / 100);
  const rem = cents % 100;
  return sign + "$" + dollars.toString() + (rem === 0 ? "" : "." + rem.toString().padStart(2, "0"));
}

function typeset(elements = []) {
  if (!window.MathJax) return;
  if (MathJax.typesetPromise) {
    if (elements.length > 0) MathJax.typesetPromise(elements);
    else MathJax.typesetPromise();
  } else if (MathJax.typeset) {
    if (elements.length > 0) MathJax.typeset(elements);
    else MathJax.typeset();
  }
}

// ---- UI helpers ----
function resetUIForNewProblem() {
  feedback.textContent = '';
  feedback.style.color = 'black';
  hintArea.innerHTML = '';
  hintSteps = [];
  hintIndex = 0;

  answerArea.innerHTML = '';
  answerArea.style.display = 'none';

  hintBtn.style.display = 'none';
  checkBtn.style.display = 'none';
}

function setFeedback(msg, color) {
  feedback.textContent = msg;
  feedback.style.color = color;
}

function addHintStep(html) {
  const d = document.createElement('div');
  d.classList.add('hint-step');
  d.style.textAlign = 'center';
  d.style.marginTop = '0.35em';
  d.innerHTML = html;
  hintArea.appendChild(d);
  typeset([d]);
}

function clearMarks() {
  const marks = answerArea.querySelectorAll('.mark');
  marks.forEach(m => m.textContent = '');
}

function makeInputRow(labelText, inputId) {
  const row = document.createElement('div');
  row.style.display = 'flex';
  row.style.justifyContent = 'center';
  row.style.alignItems = 'center';
  row.style.gap = '0.5em';
  row.style.margin = '0.35em 0';

  const label = document.createElement('span');
  label.textContent = labelText;

  const inp = document.createElement('input');
  inp.type = 'text';
  inp.id = inputId;
  inp.style.width = '160px';
  inp.style.fontSize = '1rem';

  const mark = document.createElement('span');
  mark.className = 'mark';
  mark.style.display = 'inline-block';
  mark.style.minWidth = '1.2em';
  mark.style.fontWeight = '800';

  row.appendChild(label);
  row.appendChild(inp);
  row.appendChild(mark);
  return row;
}

function buildAnswerUI() {
  answerArea.innerHTML = '';
  answerArea.style.display = 'block';

  if (!current) return;

  if (current.type === 1) {
    // one box: z value (number of rides/drinks/lb/km^2 units)
    answerArea.appendChild(makeInputRow(`Answer:`, 'ans1'));
  } else if (current.type === 2) {
    // three boxes: x,y,z costs
    answerArea.appendChild(makeInputRow(`${current.items.x}:`, 'ans1'));
    answerArea.appendChild(makeInputRow(`${current.items.y}:`, 'ans2'));
    answerArea.appendChild(makeInputRow(`${current.items.z}:`, 'ans3'));
  } else if (current.type === 3) {
    answerArea.appendChild(makeInputRow(`${current.items.x}:`, 'ans1'));
    answerArea.appendChild(makeInputRow(`${current.items.y}:`, 'ans2'));
  }

  hintBtn.style.display = 'inline-block';
  checkBtn.style.display = 'inline-block';
}

// -----------------------------
// Type (1): compare two pricing schemes
// -----------------------------
const type1Scenarios = [
  { x: "admission", y: "theme park price", z: "ride", mode: "integerZ" },
  { x: "admission", y: "wedding", z: "drink", mode: "integerZ" },
  { x: "the rental", y: "moving company fee", z: "lb", mode: "positiveZ" },
  { x: "the realtor fee", y: "land parcel price", z: "km<sup>2</sup>", mode: "positiveZ" }
];

function genType1() {
  const sc = choice(type1Scenarios);

  let flat1, flat2, rate1, rate2, zNum, zDen;

  function reasonableRanges() {
    if (sc.y === "theme park price") return [1500, 8000, 100, 900];          // $15-$80, $1-$9 per ride
    if (sc.y === "wedding") return [20000, 120000, 150, 1500];               // $200-$1200, $1.50-$15 per drink
    if (sc.y === "moving company fee") return [5000, 40000, 5, 60];           // $50-$400, $0.05-$0.60 per lb
    return [10000, 120000, 50, 900];                                         // $100-$1200, $0.50-$9 per km^2
  }

  const [flatMin, flatMax, rateMin, rateMax] = reasonableRanges();

  if (sc.mode === "integerZ") {
    const z = randInt(1, 25);
    do {
      rate1 = randInt(rateMin, rateMax);
      rate2 = randInt(rateMin, rateMax);
    } while (rate1 === rate2);

    let ok = false;
    for (let tries = 0; tries < 600; tries++) {
      flat1 = randInt(flatMin, flatMax);
      const delta = z * (rate1 - rate2);
      flat2 = flat1 + delta;
      if (flat2 > 0 && flat2 >= Math.floor(flatMin * 0.6) && flat2 <= Math.floor(flatMax * 1.4)) {
        zNum = z; zDen = 1;
        ok = true;
        break;
      }
    }
    if (!ok) return genType1();
  } else {
    let ok = false;
    for (let tries = 0; tries < 2200; tries++) {
      flat1 = randInt(flatMin, flatMax);
      flat2 = randInt(flatMin, flatMax);
      rate1 = randInt(rateMin, rateMax);
      rate2 = randInt(rateMin, rateMax);
      if (rate1 === rate2) continue;

      const num = flat2 - flat1;
      const den = rate1 - rate2;
      if (num === 0) continue;

      if ((num > 0 && den > 0) || (num < 0 && den < 0)) {
        const [rn, rd] = reduceFrac(num, den);
        if (rn > 0 && rd > 0) {
          zNum = rn; zDen = rd;
          ok = true;
          break;
        }
      }
    }
    if (!ok) return genType1();
  }

  questionText.innerHTML =
    `You are comparing two different ${sc.y}s. ` +
    `The first ${sc.y} costs a flat amount for ${sc.x} of ${moneyFromCents(flat1)}, plus ${moneyFromCents(rate1)} per ${sc.z}. ` +
    `The second ${sc.y} costs a flat amount for ${sc.x} of ${moneyFromCents(flat2)}, plus ${moneyFromCents(rate2)} per ${sc.z}. ` +
    `At how many ${sc.z}s are the two ${sc.y}s the same price?`;

  current = {
    type: 1,
    scenario: sc,
    flat1, flat2, rate1, rate2,
    zNum, zDen
  };

  // Build hint steps (no $ inside math)
  const flat1Txt = (flat1 / 100).toFixed(2).replace(/\.00$/, '');
  const flat2Txt = (flat2 / 100).toFixed(2).replace(/\.00$/, '');
  const rate1Txt = (rate1 / 100).toFixed(2).replace(/\.00$/, '');
  const rate2Txt = (rate2 / 100).toFixed(2).replace(/\.00$/, '');

  const zTex = fracToTex(zNum, zDen);

  hintSteps = [
    String.raw`Let \(z\) be the number of ${sc.z}s. Then the two prices are
    \[
      P_1 = ${flat1Txt} + ${rate1Txt}\,z,
      \qquad
      P_2 = ${flat2Txt} + ${rate2Txt}\,z.
    \]`,
    String.raw`Set the right-hand sides equal:
    \[
      ${flat1Txt} + ${rate1Txt}\,z = ${flat2Txt} + ${rate2Txt}\,z.
    \]`,
    String.raw`Solve for \(z\):
    \[
      (${rate1Txt} - ${rate2Txt})z = ${flat2Txt} - ${flat1Txt}
      \;\implies\;
      z = ${zTex}.
    \]`
  ];
}

// -----------------------------
// Type (2): ratios relative to y plus total
// -----------------------------
const type2Scenarios = [
  { x: "steak", y: "lobster", z: "caviar", base: [1200, 6500] },
  { x: "a sedan", y: "a van", z: "a truck", base: [1800000, 5200000] },
  { x: "a hammer", y: "a table saw", z: "a drill", base: [1500, 55000] },
  { x: "socks", y: "a shirt", z: "a coat", base: [800, 18000] }
];

function randomRatio() {
  const asInteger = Math.random() < 0.6;
  if (asInteger) {
    const k = randInt(2, 10);
    return { a: k, b: 1, phrase: `${k} times`, tex: `${k}` };
  }
  const d = randInt(2, 10);
  return { a: 1, b: d, phrase: `\\(\\frac{1}{${d}}\\)`, tex: `\\frac{1}{${d}}` };
}

function genType2() {
  const sc = choice(type2Scenarios);

  const rX = randomRatio(); // x = (a/b)*y
  const rZ = randomRatio(); // z = (a/b)*y

  const integerDollars = Math.random() < 0.75;

  let xCents, yCents, zCents, total;
  for (let tries = 0; tries < 2500; tries++) {
    let yc;
    if (integerDollars) {
      const yDollars = randInt(Math.floor(sc.base[0] / 100), Math.floor(sc.base[1] / 100));
      yc = yDollars * 100;
    } else {
      const lo = sc.base[0], hi = sc.base[1];
      yc = randInt(Math.floor(lo / 5), Math.floor(hi / 5)) * 5;
    }

    if ((yc * rX.a) % rX.b !== 0) continue;
    if ((yc * rZ.a) % rZ.b !== 0) continue;

    yCents = yc;
    xCents = (yc * rX.a) / rX.b;
    zCents = (yc * rZ.a) / rZ.b;
    total = xCents + yCents + zCents;

    if (total <= 0) continue;
    break;
  }

  questionText.innerHTML =
    `If ${sc.x} costs ${rX.phrase} as much as ${sc.y}, ` +
    `and ${sc.z} costs ${rZ.phrase} as much as ${sc.y}, ` +
    `and together, they all cost ${moneyFromCents(total)}, ` +
    `then how much does each item cost?`;

  current = {
    type: 2,
    items: sc,
    ratios: { rX, rZ },
    xCents, yCents, zCents, totalCents: total
  };

  const xOverY = (rX.b === 1) ? `${rX.a}` : fracToTex(rX.a, rX.b);
  const zOverY = (rZ.b === 1) ? `${rZ.a}` : fracToTex(rZ.a, rZ.b);

  const totalTxt = (total / 100).toFixed(2).replace(/\.00$/, '');
  const yTxt = (yCents / 100).toFixed(2).replace(/\.00$/, '');
  const xTxt = (xCents / 100).toFixed(2).replace(/\.00$/, '');
  const zTxt = (zCents / 100).toFixed(2).replace(/\.00$/, '');

  // coefficient: (x/y) + 1 + (z/y)
  // We'll do it as a rational: (rX.a/rX.b) + 1 + (rZ.a/rZ.b)
  const num = rX.a * rZ.b + rX.b * rZ.b + rZ.a * rX.b;
  const den = rX.b * rZ.b;
  const coefTex = fracToTex(num, den);

  hintSteps = [
    String.raw`Let \(y\) be the cost of ${sc.y}. Then
    \[
      x = \left(${xOverY}\right)y,\qquad z = \left(${zOverY}\right)y.
    \]`,
    String.raw`The total-cost equation is
    \[
      x + y + z = ${totalTxt}.
    \]
    Substitute the expressions in terms of \(y\):
    \[
      \left(${xOverY}\right)y + y + \left(${zOverY}\right)y = ${totalTxt}.
    \]`,
    String.raw`Combine like terms and solve for \(y\):
    \[
      \left(${coefTex}\right)y = ${totalTxt}
      \;\implies\;
      y = ${yTxt}.
    \]`,
    String.raw`Now substitute \(y=${yTxt}\) into the expressions:
    \[
      x = \left(${xOverY}\right)(${yTxt}) = ${xTxt},
      \qquad
      z = \left(${zOverY}\right)(${yTxt}) = ${zTxt}.
    \]`
  ];
}

// -----------------------------
// Type (3): two bills -> solve for unit prices
// -----------------------------
const type3Scenarios = [
  { x: "steak", y: "lobster", px: [1800, 6500], py: [1800, 6500] },
  { x: "sedan", y: "van", px: [1600000, 4200000], py: [1600000, 4200000] },
  { x: "hammer", y: "drill", px: [1200, 55000], py: [1200, 55000] },
  { x: "shirt", y: "coat", px: [1200, 18000], py: [1200, 18000] }
];

function genType3() {
  const sc = choice(type3Scenarios);
  const integerDollars = Math.random() < 0.75;

  function pickPrice(range) {
    if (integerDollars) {
      const dollars = randInt(Math.floor(range[0] / 100), Math.floor(range[1] / 100));
      return dollars * 100;
    }
    return randInt(Math.floor(range[0] / 5), Math.floor(range[1] / 5)) * 5;
  }

  let px, py, a, b, c, d, bill1, bill2;
  for (let tries = 0; tries < 2500; tries++) {
    px = pickPrice(sc.px);
    py = pickPrice(sc.py);
    if (px <= 0 || py <= 0) continue;

    a = randInt(2, 15);
    b = randInt(2, 15);
    c = randInt(2, 15);
    d = randInt(2, 15);

    if (a * d === b * c) continue;

    bill1 = a * px + b * py;
    bill2 = c * px + d * py;
    break;
  }

  questionText.innerHTML =
    `If you buy ${a} ${sc.x}${a === 1 ? "" : "s"} and ${b} ${sc.y}${b === 1 ? "" : "s"}, your bill is ${moneyFromCents(bill1)}, ` +
    `and if you buy ${c} ${sc.x}${c === 1 ? "" : "s"} and ${d} ${sc.y}${d === 1 ? "" : "s"}, your bill is ${moneyFromCents(bill2)}. ` +
    `How much does each item cost?`;

  current = {
    type: 3,
    items: sc,
    a, b, c, d,
    bill1Cents: bill1, bill2Cents: bill2,
    pxCents: px, pyCents: py
  };

  const bill1Txt = (bill1 / 100).toFixed(2).replace(/\.00$/, '');
  const bill2Txt = (bill2 / 100).toFixed(2).replace(/\.00$/, '');
  const yTxt = (py / 100).toFixed(2).replace(/\.00$/, '');
  const xTxt = (px / 100).toFixed(2).replace(/\.00$/, '');

  hintSteps = [
    String.raw`Let \(x\) be the cost of ${sc.x} and \(y\) be the cost of ${sc.y}. Then
    \[
      ${a}x + ${b}y = ${bill1Txt},
      \qquad
      ${c}x + ${d}y = ${bill2Txt}.
    \]`,
    String.raw`Multiply the first equation by ${c}, and the second by ${a}:
    \[
      ${c}(${a}x + ${b}y) = ${c}\cdot ${bill1Txt},
      \qquad
      ${a}(${c}x + ${d}y) = ${a}\cdot ${bill2Txt}.
    \]`,
    String.raw`Subtract one equation from the other to eliminate \(x\):
    \[
      (${c*b} - ${a*d})y = ${c}\cdot ${bill1Txt} - ${a}\cdot ${bill2Txt}.
    \]`,
    String.raw`Solve for \(y\):
    \[
      y = ${yTxt}.
    \]`,
    String.raw`Substitute \(y=${yTxt}\) into the first equation and solve for \(x\):
    \[
      ${a}x + ${b}(${yTxt}) = ${bill1Txt}
      \;\implies\;
      x = ${xTxt}.
    \]`
  ];
}

// -----------------------------
// Checking answers
// -----------------------------
function markInput(inp, ok) {
  const mark = inp.parentElement.querySelector('.mark');
  if (!mark) return;
  mark.textContent = ok ? '✓' : '✗';
  mark.style.color = ok ? 'green' : 'crimson';
}

function checkAnswers() {
  if (!current) return;
  clearMarks();
  setFeedback('', 'black');

  if (current.type === 1) {
    const inp = document.getElementById('ans1');
    const parsed = parseExactRational(inp.value);
    if (!parsed.ok) {
      setFeedback(parsed.msg, 'crimson');
      return;
    }
    const [n, d] = reduceFrac(parsed.num, parsed.den);
    const [an, ad] = reduceFrac(current.zNum, current.zDen);
    const ok = (n === an && d === ad);
    markInput(inp, ok);
    setFeedback(ok ? 'Correct!' : 'Not quite.', ok ? 'green' : 'crimson');
    return;
  }

  if (current.type === 2) {
    const inps = [document.getElementById('ans1'), document.getElementById('ans2'), document.getElementById('ans3')];
    const answers = [current.xCents, current.yCents, current.zCents];
    let allOk = true;
    let anyOk = false;

    for (let i = 0; i < 3; i++) {
      const parsed = parseMoneyToCents(inps[i].value);
      if (!parsed.ok) {
        allOk = false;
        markInput(inps[i], false);
        continue;
      }
      const ok = (Math.round(parsed.cents) === Math.round(answers[i]));
      markInput(inps[i], ok);
      allOk = allOk && ok;
      anyOk = anyOk || ok;
    }

    if (allOk) setFeedback('Correct!', 'green');
    else if (anyOk) setFeedback('Some parts are correct.', 'crimson');
    else setFeedback('Not quite.', 'crimson');
    return;
  }

  if (current.type === 3) {
    const inps = [document.getElementById('ans1'), document.getElementById('ans2')];
    const answers = [current.pxCents, current.pyCents];
    let allOk = true;
    let anyOk = false;

    for (let i = 0; i < 2; i++) {
      const parsed = parseMoneyToCents(inps[i].value);
      if (!parsed.ok) {
        allOk = false;
        markInput(inps[i], false);
        continue;
      }
      const ok = (Math.round(parsed.cents) === Math.round(answers[i]));
      markInput(inps[i], ok);
      allOk = allOk && ok;
      anyOk = anyOk || ok;
    }

    if (allOk) setFeedback('Correct!', 'green');
    else if (anyOk) setFeedback('Some parts are correct.', 'crimson');
    else setFeedback('Not quite.', 'crimson');
    return;
  }
}

// -----------------------------
// Hint button
// -----------------------------
function showNextHint() {
  if (!hintSteps || hintSteps.length === 0) return;
  if (hintIndex >= hintSteps.length) return;
  addHintStep(hintSteps[hintIndex]);
  hintIndex++;
}

// -----------------------------
// Start: generate one of the 3 types
// -----------------------------
startBtn.addEventListener('click', () => {
  playSound('click-sound');
  questionText.textContent = '';
  resetUIForNewProblem();
  current = null;

  const t = randInt(1, 3);
  if (t === 1) genType1();
  if (t === 2) genType2();
  if (t === 3) genType3();

  buildAnswerUI();
  typeset();
});

checkBtn.addEventListener('click', () => {
  playSound('click-sound');
  checkAnswers();
});

hintBtn.addEventListener('click', () => {
  playSound('click-sound');
  showNextHint();
});
</script>



  <audio id="click-sound" src="button.mp3" preload="auto"></audio>
  <audio id="set-sound" src="set2.mp3" preload="auto"></audio>

</body>
</html>
