<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="description" content="Personal website of Ben Fraser, with math education activities for students and teachers.">
  <meta charset="UTF-8" />
  <title>Probability I Activity</title>
  <link rel="stylesheet" href="/style.css" />

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
</head>
<body>
  <header>
    <h1>Probability I Activity</h1>
    <div id="nav-placeholder"></div>
      <script>
fetch("/nav.html")
  .then(response => response.text())
  .then(html => {
    document.getElementById("nav-placeholder").innerHTML = html;

    const currentPath = window.location.pathname.replace(/\/index\.html$/, "/");
    const navLinks = document.querySelectorAll("#nav-placeholder a");
    navLinks.forEach(link => {
      const linkPath = new URL(link.href).pathname.replace(/\/index\.html$/, "/");
      if (linkPath === currentPath) {
        link.classList.add("active");
      }
    });

    const s = document.createElement("script");
    s.src = "/mascot.js";
    s.defer = true;
    document.body.appendChild(s); 
  })
  .catch(err => {
    console.error("Failed to load nav:", err);
  });
</script>
  </header>
  <main>

    <p>We begin our introduction to probability with the simplest case: when an experiment is performed with equally likely outcomes.  Here
    "experiment" need not refer to the hard science you had in mind, but something as simple as rolling a 6-sided die.  There are 6 equally likely
    outcomes: the numbers from one to six.  We call the set of all possible outcomes the <b>sample space</b>, denoted by S:
    \[S = \{1,2,3,4,5,6\}\]
      An <b>outcome</b> is a single element of the sample space, and an <b>event</b> is a subset of the sample space. Each of the six outcomes in this 
      example are equally likely (assuming the die is not weighted), and it is not possible for any two of the outcomes to occur.  This property: 
      that the outcomes do not overlap, is that they are <b>mutually exclusive</b>.  We will see that when events
      are mutually exclusive, the probability that any one of them happens is equal to the sum of their individual probabilities.
    </p>
    
    <p>When there are \(n\) many equally likely outcomes, then the probability of any one of them occurring is
    \[\frac{1}{n}\]
    Say we want to find the probability of rolling either a 6 or less than a 3, where \(X\) is the outcome of the roll.  The two events, "rolling a 6"
      and "rolling less than 3" are mutually exclusive: they don't overlap.  So,
    \[P(X < 3 \cup X = 6) = P(X < 3) + P(X = 6)\]
    Then, the events of rolling less than a 3 is the same as rolling a 2 or lower, which is the same as rolling a 1 or 2.  So,
    \[P(X < 3) + P(X = 6) = P(X = 1) + P(X = 2) + P(X = 6) = \frac{1}{6} + \frac{1}{6} + \frac{1}{6} = \frac{3}{6} = \frac{1}{2}\]</p>

    <p><u><b>Converting fractions to decimals:</b></u></p>

    <p>This is a simple conversion if you have a calculator: simply divide the numerator by the denominator.  If you don't, let the long division
    begin!  See below converting 3/8 into a decimal:</p>

    <div style="flex: 1;">
        \[
       \require{enclose}
       \begin{array}{rr}
       & 0.375 \hspace{1mm}\\
       8 & \enclose{longdiv}{3.000} \\
       & \underline{- 2.4} \hspace{7mm}\\
       & .60 \hspace{4.5mm}\\
       & \underline{- .56 \hspace{1mm}}\hspace{3.5mm}\\
       & .040 \hspace{2mm}\\
       & \underline{- .040 \hspace{2mm}}\\
       & .000 \hspace{2mm}
       \end{array}
       \]
      </div>

    <p>Sometimes the division doesn't result in a <i>terminating</i> decimal.  Sometimes we enter an endless cycle: these <i>repeating</i> decimals
    can be found by dividing until the first repetition after the decimal point occurs.  See below a (somewhat overworked) example using the flexible scaffold
    (partial quotients) division method, to convert 1/7 into a decimal:</p>

    <div style="flex: 1;">
        \[
       \require{enclose}
       \begin{array}{rr}
       & 0.0000001 \hspace{1mm}\\
       & 0.0000070 \hspace{1mm}\\
       & 0.0000500 \hspace{1mm}\\
       & 0.0008000 \hspace{1mm}\\
       & 0.0020000 \hspace{1mm}\\
       & 0.0400000 \hspace{1mm}\\
       & 0.1000000 \hspace{1mm}\\
       7 & \enclose{longdiv}{1.0000000} \\
       & \underline{- .7000000} \hspace{1mm}\\
       & .3000000 \hspace{1mm}\\
       & \underline{- .2800000 \hspace{1mm}}\\
       & .0200000 \hspace{1mm}\\
       & \underline{- .0140000 \hspace{1mm}}\\
       & .0060000 \hspace{1mm}\\
       & \underline{- .0056000 \hspace{1mm}}\\
       & .0004000 \hspace{1mm}\\
       & \underline{- .0003500 \hspace{1mm}}\\
       & .0000500 \hspace{1mm}\\
       & \underline{- .0000490 \hspace{1mm}}\\
       & .0000010 \hspace{1mm}\\
       & \underline{- .0000007 \hspace{1mm}}\\
       & .0000003 \hspace{1mm}\\
       \end{array}
       \]
      </div>

    <p>Since we have reached a repetition of the digit 1, we know the answer is the repeating decimal \(0.\overline{142857}\).</p>

    <p><u><b>Converting decimals to fractions:</b></u></p>

    <p>The reverse process is somewhat more difficult.  In the case of a terminating decimal, we can place the decimal part of the number over 
      a power of ten which has one more digit than that part, to convert it to a fraction.  For instance, to convert 3.75 into a fraction:
    \[3.75 = 3 + 0.75 = 3 + \frac{75}{100} = 3 + \frac{75 \div 25}{100 \div 25} = 3 + \frac{3}{4} = 3\frac{3}{4}\]
    In the case of repeating decimals, things are more difficult.  We will start with the "long way" of converting repeating decimals into fractions, 
      and in so doing develop a shorthand method.  First, let us try to convert \(15.\overline{45}\) into a fraction.  Our goal is to solve for 
    \[n = 15.\overline{45}\]
    The repeating part has a "period" of 2 (the length of the string of repeating digits).  So if we multiply by \(10^2 = 100\), we obtain another 
    number containing the same repeating part beginning immediately after the decimal point:
    \[100n = 1545.\overline{45}\]
    We can then subtract the two equations from one another to eliminate the repeating part:
    \[100n - n = 1545.\overline{45} - 15.\overline{45}\]
    \[\implies 99n = 1530\]
    \[\implies n = \frac{1530}{99} = \frac{170}{11} = 15\frac{5}{11}\]</p>

    <p><b>Now, the shorthand method of that.</b>  Just place the repeating part over an equal number of 9s:
    \[15.\overline{45} = 15 + \frac{45}{99} = 15 + \frac{5}{11} = 15\frac{5}{11}\]</p>

    <p>Next let us consider a more challenging problem, where the repeating part does not begin immediately after the decimal point.  Suppose we 
      want to convert \(2.050\overline{230769}\) into a fraction.  Our goal is to solve for 
    \[n = 2.050\overline{230769}\]
    We can shift the decimal point so that the repeating part starts immediately after the decimal point:
    \[1000n = 2050.\overline{230769}\]
    Since the period here is 6, we can multiply by \(10^6 = 1000000\) to obtain another number with the same repeating part: 
      \[1000000000n = 2050230769.\overline{230769}\]
    Now we can subtract these equations from one another to eliminate the repeating part:
    \[1000000000n - 1000n = 2050230769.\overline{230769} - 2050.\overline{230769}\]
    \[\implies 999999000n = 2050228719\]
    \[\implies n = \frac{2050228719}{999999000} = \frac{26653}{13000} = 2\frac{653}{13000}\]</p>

    <p><b>Now, the shorthand method of that.</b>  We place the repeating part over the same number of 9s, multiplied by 1 over a power of ten which shifts
      the repeating part into its position:
    \[2.050\overline{230769} = 2 + \frac{50}{1000} + \frac{1}{1000} \cdot \frac{230769}{999999} = 2 + \frac{5}{100} + \frac{3}{13000} = 2 + 
      \frac{650}{13000} + \frac{3}{13000} = 2\frac{653}{13000}\]</p></p>

    <p><u><b>Converting decimals to percent (and vice versa):</b></u></p>

    <p>Since the word "percent" literally means "per hundred", this conversion is easy to remember.  To go from a decimal number to percent, 
      <i>multiply</i> it by 100:
    \[0.065 = 0.065 \cdot 100\% = 6.5\%\]
    And to go from a percent to a decimal number, <i>divide</i> it by 100:
      \[39\% = \frac{39\%}{100\%} = 0.39\]
    </p>

    <div class="button-container">
      <button id="start-btn" class="rubber-button">Start!</button>
    </div>
    
    <p id="question-text" class="math"></p>

    <div class="button-container">
      <button id="hint-btn" class="rubber-button">Hint</button>
    </div>
    
    <div id="hint-area" class="math" style="margin-top: 1em;"></div>


    <div id="answer-section" style="margin-top: 20px; text-align: center;">
      <label for="user-answer">Enter your answer:</label>
      <input type="text" id="user-answer" />
      <label id="repeating-container" style="margin-left: 0.5em;">
        <input type="checkbox" id="repeating-checkbox" />
        Repeating
      </label>
      <button id="check-answer-btn" class="rubber-button" style="margin-left: 0.5em;">Check Answer</button>
      <p id="answer-feedback" style="font-weight: bold; margin-top: 10px;"></p>
    </div>

  </main>
  <script>
    // -----------------------------
    // State
    // -----------------------------
    let currentFraction = null; // { p, q }
    let decimalInfo = null;     // decomposition for the raw decimal form of p/q
    let percentInfo = null;     // decomposition for 100 * p/q
    let givenForm = null;       // 'fraction' | 'decimal' | 'percent'
    let targetForm = null;      // one of the remaining two

    const hintBtn = document.getElementById('hint-btn');
    const hintArea = document.getElementById('hint-area');
    let hintSteps = [];
    let hintIndex = 0;

    const startBtn = document.getElementById('start-btn');
    const questionText = document.getElementById('question-text');

    const answerInput = document.getElementById('user-answer');
    const repeatingCheckbox = document.getElementById('repeating-checkbox');
    const repeatingContainer = document.getElementById('repeating-container');
    const feedback = document.getElementById('answer-feedback');

    // -----------------------------
    // Utility: GCD for fraction equality
    // -----------------------------
    function gcd(a, b) {
      a = Math.abs(a);
      b = Math.abs(b);
      while (b !== 0) {
        const t = b;
        b = a % b;
        a = t;
      }
      return a;
    }

    // -----------------------------
    // Utility: decimal decomposition of a rational number
    // numerator / denominator  (both integers)
    // Returns:
    // {
    //   type: 'terminating' | 'repeating',
    //   sign: 1 or -1,
    //   intPart: integer part >= 0,
    //   nonRepeat: string of digits (may be ''),
    //   repeat: string of digits ('' if terminating)
    // }
    // -----------------------------
    function decimalDecomposition(numerator, denominator) {
      let sign = 1;
      if (numerator < 0) {
        sign *= -1;
        numerator = -numerator;
      }
      if (denominator < 0) {
        sign *= -1;
        denominator = -denominator;
      }

      const intPart = Math.floor(numerator / denominator);
      let remainder = numerator % denominator;

      if (remainder === 0) {
        // Exact integer
        return {
          type: 'terminating',
          sign,
          intPart,
          nonRepeat: '',
          repeat: ''
        };
      }

      const digits = [];
      const remainderIndex = {};
      let repeatStart = -1;

      while (remainder !== 0 && remainderIndex[remainder] === undefined) {
        remainderIndex[remainder] = digits.length;
        remainder *= 10;
        const digit = Math.floor(remainder / denominator);
        digits.push(digit);
        remainder = remainder % denominator;
      }

      if (remainder === 0) {
        // Terminating decimal
        return {
          type: 'terminating',
          sign,
          intPart,
          nonRepeat: digits.join(''),
          repeat: ''
        };
      } else {
        // Repeating decimal
        repeatStart = remainderIndex[remainder];
        const nonRepeatDigits = digits.slice(0, repeatStart);
        const repeatDigits = digits.slice(repeatStart);
        return {
          type: 'repeating',
          sign,
          intPart,
          nonRepeat: nonRepeatDigits.join(''),
          repeat: repeatDigits.join('')
        };
      }
    }

    // -----------------------------
    // Formatting functions
    // -----------------------------
    function formatFractionTeX(p, q) {
      return `\\dfrac{${p}}{${q}}`;
    }

    function formatDecimalTeX(info, asPercent) {
      let s = '';
      if (info.sign < 0) {
        s += '-';
      }
      s += info.intPart.toString();

      if (info.type === 'terminating') {
        if (info.nonRepeat && info.nonRepeat.length > 0) {
          s += '.' + info.nonRepeat;
        }
      } else {
        s += '.';
        if (info.nonRepeat && info.nonRepeat.length > 0) {
          s += info.nonRepeat;
        }
        s += `\\overline{${info.repeat}}`;
      }

      if (asPercent) {
        s += '\\%';
      }
      return s;
    }

    // -----------------------------
    // Parsing user input
    // -----------------------------
    function parseFractionInput(str) {
      const trimmed = str.trim();
      const fracRegex = /^(\d+)\s*\/\s*(\d+)$/;
      const match = trimmed.match(fracRegex);
      if (!match) {
        return null;
      }
      const num = parseInt(match[1], 10);
      const den = parseInt(match[2], 10);
      if (!Number.isInteger(num) || !Number.isInteger(den) || den === 0) {
        return null;
      }
      return { num, den };
    }

    function parseDecimalInput(str) {
      const trimmed = str.trim();
      if (!trimmed) return null;

      // Allow forms like "0.25", ".25", "25", "-0.3"
      const regex = /^-?\d*(\.\d*)?$/;
      if (!regex.test(trimmed)) return null;

      let s = trimmed;
      let sign = 1;
      if (s[0] === '-') {
        sign = -1;
        s = s.slice(1);
      }

      let intPartStr = s;
      let fracPartStr = '';

      if (s.includes('.')) {
        const parts = s.split('.');
        intPartStr = parts[0] === '' ? '0' : parts[0];
        fracPartStr = parts[1] || '';
      } else {
        intPartStr = s === '' ? '0' : s;
      }

      let intPart = parseInt(intPartStr, 10);
      if (Number.isNaN(intPart)) intPart = 0;

      return {
        sign,
        intPart,
        fracDigits: fracPartStr
      };
    }

    // -----------------------------
    // Equality checks
    // -----------------------------
    function fractionEquals(num1, den1, num2, den2) {
      // No need to reduce; cross-multiply
      return num1 * den2 === num2 * den1;
    }

    function decimalEqualsFraction(decimalParsed, fraction) {
      // decimalParsed: { sign, intPart, fracDigits }
      // fraction: { p, q } (positive)
      if (decimalParsed.sign < 0) {
        return false; // our numbers are always positive
      }
      const fracDigits = decimalParsed.fracDigits;
      const k = fracDigits.length;
      const intPart = decimalParsed.intPart;

      let fracInt = 0;
      if (k > 0) {
        fracInt = parseInt(fracDigits, 10);
        if (Number.isNaN(fracInt)) fracInt = 0;
      }

      const num = intPart * Math.pow(10, k) + fracInt;
      const den = Math.pow(10, k);

      // Compare num/den to p/q
      return fractionEquals(num, den, fraction.p, fraction.q);
    }

    // For percent answers, 100 * (p/q)
    function decimalEqualsPercentFraction(decimalParsed, fraction) {
      if (decimalParsed.sign < 0) return false;
      const fracDigits = decimalParsed.fracDigits;
      const k = fracDigits.length;
      const intPart = decimalParsed.intPart;

      let fracInt = 0;
      if (k > 0) {
        fracInt = parseInt(fracDigits, 10);
        if (Number.isNaN(fracInt)) fracInt = 0;
      }

      const num = intPart * Math.pow(10, k) + fracInt;
      const den = Math.pow(10, k);

      // compare num/den to 100 * p / q
      const targetNum = 100 * fraction.p;
      const targetDen = fraction.q;

      return fractionEquals(num, den, targetNum, targetDen);
    }

    // -----------------------------
    // Repeating-answer checks
    // -----------------------------
    function repeatingAnswerMatches(decimalParsed, info) {
      if (info.type !== 'repeating') return false;
      if (decimalParsed.sign < 0) return false;
      if (!decimalParsed.fracDigits || decimalParsed.fracDigits.length === 0) return false;

      if (decimalParsed.intPart !== info.intPart) return false;

      const canonicalDigits = (info.nonRepeat || '') + (info.repeat || '');
      return decimalParsed.fracDigits === canonicalDigits;
    }

    // -----------------------------
    // Hint construction
    // -----------------------------
    function buildHintSteps() {
      hintSteps = [];
      hintIndex = 0;
      hintArea.innerHTML = '';

      if (!currentFraction || !decimalInfo || !percentInfo || !givenForm || !targetForm) {
        return;
      }

      const p = currentFraction.p;
      const q = currentFraction.q;

      const seq = ['fraction', 'decimal', 'percent'];
      const path = [];

      const iG = seq.indexOf(givenForm);
      const iT = seq.indexOf(targetForm);

      if (iG <= iT) {
        for (let i = iG; i <= iT; i++) path.push(seq[i]);
      } else {
        for (let i = iG; i >= iT; i--) path.push(seq[i]);
      }

      const fracTeX = formatFractionTeX(p, q);
      const decTeX = formatDecimalTeX(decimalInfo, false);
      const percTeX = formatDecimalTeX(percentInfo, true);

      for (let i = 0; i < path.length - 1; i++) {
        const from = path[i];
        const to = path[i + 1];

        if (from === 'fraction' && to === 'decimal') {
          const general = `\\[\\text{To convert a fraction to a decimal, divide the numerator by the denominator. For this fraction, divide ${p} by ${q}.}\\]`;
          const example = `\\[ ${fracTeX} = ${decTeX} \\]`;
          hintSteps.push(general, example);
        } else if (from === 'decimal' && to === 'fraction') {
          const general = `\\[\\text{To convert a decimal to a fraction, write the decimal digits over a power of 10 with one additional digit, and then simplify.}\\] 
          \\[\\text{For a repeating decimal, see the 9s strategy above.}\\]`;
          let example = ``;
          if (decimalInfo.type == `terminating`){
            example = `\\[ ${decTeX} = \\frac{${decimalInfo.nonRepeat}}{${10**decimalInfo.nonRepeat.length}} = ${fracTeX} \\]`;
          } else if (decimalInfo.nonRepeat.length > 0) {
            example = `\\[ ${decTeX} = \\frac{${decimalInfo.nonRepeat}}{${10**decimalInfo.nonRepeat.length}} + \\frac{1}{${10**decimalInfo.nonRepeat.length}} \\cdot \\frac{${decimalInfo.repeat}}{${Number('9'.repeat(decimalInfo.repeat.length))}} = ${fracTeX} \\]`;
          } else {
            example = `\\[ ${decTeX} = \\frac{${decimalInfo.repeat}}{${Number('9'.repeat(decimalInfo.repeat.length))}} = ${fracTeX} \\]`;
          }
          hintSteps.push(general, example);
        } else if (from === 'decimal' && to === 'percent') {
          const general = `\\[\\text{To convert a decimal to a percent, multiply by 100 and attach a percent sign.}\\]`;
          const example = `\\[ ${decTeX} \\times 100 = ${percTeX} \\]`;
          hintSteps.push(general, example);
        } else if (from === 'percent' && to === 'decimal') {
          const general = `\\[\\text{To convert a percent to a decimal, divide by 100 and remove the percent sign.}\\]`;
          const example = `\\[ ${percTeX} = ${decTeX} \\]`;
          hintSteps.push(general, example);
        }
      }
    }

    // -----------------------------
    // Question generation
    // -----------------------------
    startBtn.addEventListener('click', () => {
      // Play sound
      const sound = document.getElementById('click-sound');
      if (sound) {
        sound.currentTime = 0;
        sound.play();
      }

      // Reset feedback / answer / hints
      feedback.textContent = '';
      feedback.style.color = 'black';
      answerInput.value = '';
      repeatingCheckbox.checked = false;
      hintArea.innerHTML = '';
      hintSteps = [];
      hintIndex = 0;

      // Generate random fraction:
      // denominator between 2 and 10
      const q = Math.floor(Math.random() * 29) + 2; // 2..30
      const p = Math.floor(Math.random() * (q - 1)) + 1; // 1..(q-1)

      currentFraction = { p, q };

      // Precompute decimal and percent decompositions
      decimalInfo = decimalDecomposition(p, q);
      // percent is 100 * p / q
      percentInfo = decimalDecomposition(100 * p, q);

      // Choose given form and target form
      const forms = ['fraction', 'decimal', 'percent'];
      givenForm = forms[Math.floor(Math.random() * forms.length)];

      const remaining = forms.filter(f => f !== givenForm);
      targetForm = remaining[Math.floor(Math.random() * remaining.length)];

      // Show/hide repeating checkbox depending on target form
      if (targetForm === 'fraction') {
        repeatingContainer.style.display = 'none';
        repeatingCheckbox.checked = false;
      } else {
        repeatingContainer.style.display = 'inline-block';
      }

      // Build TeX for the question
      let givenTeX = '';
      if (givenForm === 'fraction') {
        givenTeX = formatFractionTeX(p, q);
      } else if (givenForm === 'decimal') {
        givenTeX = formatDecimalTeX(decimalInfo, false);
      } else {
        // percent
        givenTeX = formatDecimalTeX(percentInfo, true);
      }

      const targetLabel =
        targetForm === 'fraction'
          ? 'fraction'
          : (targetForm === 'decimal' ? 'decimal' : 'percent');

      const question = `\\[ \\text{Convert } ${givenTeX} \\text{ to a ${targetLabel}.} \\]`;

      questionText.innerHTML = question;
      if (window.MathJax && MathJax.typeset) {
        MathJax.typeset([questionText]);
      }

      // Build hint steps for this problem
      buildHintSteps();
    });

    // -----------------------------
    // Check answer
    // -----------------------------
    document.getElementById('check-answer-btn').addEventListener('click', () => {
      const sound = document.getElementById('click-sound');
      if (sound) {
        sound.currentTime = 0;
        sound.play();
      }

      const raw = answerInput.value.trim();
      const isRepeating = repeatingCheckbox.checked;

      if (!currentFraction || !givenForm || !targetForm) {
        feedback.textContent = 'Press Start to get a question first.';
        feedback.style.color = 'black';
        return;
      }

      if (!raw) {
        feedback.textContent = 'Please enter an answer.';
        feedback.style.color = 'black';
        return;
      }

      let correct = false;
      let message = '';

      if (targetForm === 'fraction') {
        // Expect something like "3/4"
        const frac = parseFractionInput(raw);
        if (!frac) {
          message = 'Please enter your answer as a fraction, like 3/4.';
          feedback.textContent = message;
          feedback.style.color = 'black';
          return;
        }

        correct = fractionEquals(frac.num, frac.den, currentFraction.p, currentFraction.q);

        if (correct) {
          message = 'Correct!';
          feedback.style.color = 'green';
        } else {
          message = 'Incorrect. Try again!';
          feedback.style.color = 'red';
        }

      } else if (targetForm === 'decimal') {
        const parsed = parseDecimalInput(raw);
        if (!parsed) {
          message = 'Please enter your answer as a decimal number (for example, 0.25).';
          feedback.textContent = message;
          feedback.style.color = 'black';
          return;
        }

        if (!isRepeating) {
          // Non-repeating interpretation
          if (decimalInfo.type === 'repeating') {
            // This rational has a repeating decimal expansion,
            // so they must use the Repeating checkbox and the full cycle.
            message = 'This decimal repeats. Include one full repeating cycle after the decimal point and check the "Repeating" box.';
            feedback.textContent = message;
            feedback.style.color = 'black';
            return;
          } else {
            // Terminating: numeric equality to the fraction is enough
            correct = decimalEqualsFraction(parsed, currentFraction);
            if (correct) {
              message = 'Correct!';
              feedback.style.color = 'green';
            } else {
              message = 'Incorrect. Make sure you give the full decimal expansion.';
              feedback.style.color = 'red';
            }
          }
        } else {
          // Repeating interpretation
          if (decimalInfo.type !== 'repeating') {
            message = 'This decimal does not repeat.';
            feedback.textContent = message;
            feedback.style.color = 'black';
            return;
          }
          // Check against canonical repeating form
          correct = repeatingAnswerMatches(parsed, decimalInfo);
          if (correct) {
            message = 'Correct!';
            feedback.style.color = 'green';
          } else {
            message = 'Incorrect. Make sure you include exactly one full repeating cycle after the decimal point.';
            feedback.style.color = 'red';
          }
        }

      } else if (targetForm === 'percent') {
        const parsed = parseDecimalInput(raw);
        if (!parsed) {
          message = 'Please enter the percent as a decimal number (for example, 25 or 37.5). Do not include the % sign.';
          feedback.textContent = message;
          feedback.style.color = 'black';
          return;
        }

        if (!isRepeating) {
          if (percentInfo.type === 'repeating') {
            message = 'This percent has a repeating decimal part. Include one full repeating cycle and check the "Repeating" box.';
            feedback.textContent = message;
            feedback.style.color = 'black';
            return;
          } else {
            // Terminating percent: numeric equality with 100 * (p/q)
            correct = decimalEqualsPercentFraction(parsed, currentFraction);
            if (correct) {
              message = 'Correct!';
              feedback.style.color = 'green';
            } else {
              message = 'Incorrect. Make sure you give the full decimal expansion for the percent.';
              feedback.style.color = 'red';
            }
          }
        } else {
          if (percentInfo.type !== 'repeating') {
            message = 'This percent does not have a repeating decimal part.';
            feedback.textContent = message;
            feedback.style.color = 'black';
            return;
          }
          correct = repeatingAnswerMatches(parsed, percentInfo);
          if (correct) {
            message = 'Correct!';
            feedback.style.color = 'green';
          } else {
            message = 'Incorrect. Make sure your digits match one full repeating cycle.';
            feedback.style.color = 'red';
          }
        }
      }

      feedback.textContent = message;
    });

    // -----------------------------
    // Hint button
    // -----------------------------
    hintBtn.addEventListener('click', () => {
      const sound = document.getElementById('click-sound');
      if (sound) {
        sound.currentTime = 0;
        sound.play();
      }

      if (!hintSteps || hintSteps.length === 0) {
        const hintPara = document.createElement('div');
        hintPara.classList.add('hint-step');
        hintPara.textContent = 'No hints are available for this question.';
        hintArea.appendChild(hintPara);
        if (window.MathJax && MathJax.typeset) {
          MathJax.typeset([hintPara]);
        }
        return;
      }

      if (hintIndex < hintSteps.length) {
        const hintPara = document.createElement('div');
        hintPara.classList.add('hint-step');
        hintPara.innerHTML = hintSteps[hintIndex];
        hintArea.appendChild(hintPara);
        if (window.MathJax && MathJax.typeset) {
          MathJax.typeset([hintPara]);
        }
        hintIndex++;
      }
    });
  </script>

  <audio id="click-sound" src="button.mp3" preload="auto"></audio>
  <audio id="set-sound" src="set2.mp3" preload="auto"></audio>

</body>
</html>
