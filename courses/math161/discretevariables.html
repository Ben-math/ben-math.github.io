
<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="description" content="Personal website of Ben Fraser, with math education activities for students and teachers.">
  <meta charset="UTF-8" />
  <title>Discrete Random Variables Activity</title>
  <link rel="stylesheet" href="/style.css" />

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
</head>
<body>
  <header>
    <h1>Discrete Random Variables Activity</h1>
    <div id="nav-placeholder"></div>
      <script>
fetch("/nav.html")
  .then(response => response.text())
  .then(html => {
    document.getElementById("nav-placeholder").innerHTML = html;

    const currentPath = window.location.pathname.replace(/\/index\.html$/, "/");
    const navLinks = document.querySelectorAll("#nav-placeholder a");
    navLinks.forEach(link => {
      const linkPath = new URL(link.href).pathname.replace(/\/index\.html$/, "/");
      if (linkPath === currentPath) {
        link.classList.add("active");
      }
    });

    const s = document.createElement("script");
    s.src = "/mascot.js";
    s.defer = true;
    document.body.appendChild(s); 
  })
  .catch(err => {
    console.error("Failed to load nav:", err);
  });
</script>
  </header>
  <main>

    <p>A random variable \(X\) is a function
      \[X: S \mapsto \mathbb{R}\]
      which maps outcomes in a sample space to real numbers.  For example, it might map the outcome of rolling two dice to the sum of the two rolls.
    </p>
    
    <p>Where the range of the function \(X\) is either finite or countably infinite, it is called a <b>discrete random variable</b>.
    </p>

      
    <p>A common question to ask is
      \[\text{"What is the probability the random variable \(X\) takes on the value \(x\)?"}\]
      That is, we are asking for \(P(X = x)\).  For instance, if the random variable \(X\) represents the sum of the rolls of two 6-sided dice, then 
      \[P(X = 4) = \frac{3}{36} = \frac{1}{12}\]
      because there are 3 outcomes
      \[(1,3), (2,2), (3,1)\]
      out of the 36 in the sample space which result in a sum of 4.
    </p>


    <p>A function which maps all of the values a discrete random variable \(X\) takes on to their respective probabilities is called its 
      <b>probability distribution function</b> (we will abbreviate this with pdf), defined by
      \[f(x) = P(X = x)\]
      A pdf has similar properties to those of a probability itself: since its values are probabilities, they are 
      between 0 and 1, and because it gives the probabilities of all possible values the random variable can take on, the sum of all its values is 1.
    </p>

    <p>It's that second property - that its values sum to 1 - which is often helpful in checking whether you've correctly computed its values, as you 
      can afterwards verify that they sum to 1.  For example, if we compute all the values of the pdf \(f\) of the random 
      variable \(X\) which gives the sum of two 6-sided dice, we obtain the following table of values (note the values \(x\) are the possible sums when 
      rolling two 6-sided dice, so they are between 2 and 12):
      \[
      \begin{array}{|c|c|c|c|c|c|c|c|c|c|c|c|}
      \hline
      x & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 & 11 & 12\\
      \hline
      f(x) & \frac{1}{36} & \frac{2}{36} & \frac{3}{36} & \frac{4}{36} & \frac{5}{36} & \frac{6}{36} & \frac{5}{36} & \frac{4}{36} & \frac{3}{36} &
       \frac{2}{36} & \frac{1}{36}\\
      \hline
      \end{array}
      \]
      We can verify we've found the correct values of \(f(x)\) above by confirming
      \[\frac{1}{36} + \frac{2}{36} + \frac{3}{36} + \frac{4}{36} + \frac{5}{36} + \frac{6}{36} + \frac{5}{36} + \frac{4}{36} + \frac{3}{36} + 
      \frac{2}{36} + \frac{1}{36} = \frac{36}{36} = 1\] 
      Other than asking for the probability that the random variable takes on a particular value, we may ask for the probability it is greater or less 
      than some value, or falls within a range.  This amounts to summing individual values of the pdf.  For instance, in the preceding example, to find 
      the probability of rolling higher than a 9,
      \[P(X > 9) = P(X = 10) + P(X = 11) + P(X = 12) = f(10) + f(11) + f(12) = \frac{3}{36} + \frac{2}{36} + \frac{1}{36} = \frac{6}{36} = \frac{1}{6}\]
      or to find the odds of rolling between a 5 and 7 (inclusive):
      \[P(5 \leq X \leq 7) = P(X = 5) + P(X = 6) + P(X = 7) = \frac{4}{36} + \frac{5}{36} + \frac{6}{36} = \frac{15}{36} = \frac{5}{12}\]
    </p>

    <p>We've previously seen that to compute the mean of a set of data, we are computing a weighted average of the data values, where each value is 
      weighted by its relative frequency.  For instance, if playing basketball you take 20 shots, miss on 10 of them, score 2 points on 6 of them, and 
      score 3 points on 4 of them, then the mean points you scored per shot is
      \[\frac{10}{20}(0) + \frac{6}{20}(2) + \frac{4}{20}(3) = \frac{24}{20} = 1.2\]
      This same idea extends to finding the mean - also called <b>expected value</b> - of a random variable \(X\), denoted by \(E(X) = \mu\).  Observe 
      that the relative frequency of a data value <b>is</b> the probability it would be selected at random from the data set.  So, the expected value 
      of \(X\) is computed exactly as you'd expect: as a weighted average of the values of \(X\), weighted by their respective probabilities (the values 
      of the pdf):
      \[E(X) = \sum_x xf(x)\]
      For example, to find the expected value of the sum of two dice \(X\), we compute
      \[\mu = \frac{1}{36}(2) + \frac{2}{36}(3) + \frac{3}{36}(4) + \frac{4}{36}(5) + \frac{5}{36}(6) + \frac{6}{36}(7) + \frac{5}{36}(8) + 
      \frac{4}{36}(9) + \frac{3}{36}(10) + \frac{2}{36}(11) + \frac{1}{36}(12) = \frac{252}{36} = 7\]
      This is in line with what we'd expect, since the pdf is symmetric about 7.
    </p>

    <p>Finally, our formula for the standard deviation \(\sigma\) of a random variable \(X\) is also as we've seen previously (just replacing relative 
      frequency with the values of the pdf in our formula):
      \[\sigma = \sqrt{\sum_x\left[(x - \mu)^2f(x)\right]}\]
      So to find the standard deviation in our running example,
      \[\sigma = \sqrt{(2-7)^2 \cdot \frac{1}{36} + (3-7)^2 \cdot \frac{2}{36} + ... + (12-7)^2 \cdot \frac{1}{36}} = \sqrt{\frac{210}{36}} \approx 2.42\]
    </p>


    <p>Generally you would find it helpful to use a similar "table method" for organizing the steps of computing standard deviation as previously.  For 
      instance, let \(X\) be the random variable giving your winnings from a lottery ticket.  If you have a 75% chance of winning nothing, a 20% chance 
      of winning $5, and a 5% chance of winning $100, then we can construct a table with the pdf for \(X\), and extend it to the terms in the standard 
      deviation computation sum once we've found the mean:
      \[\mu = 0(0.75) + 5(0.2) + 100(0.05) = 6\]
      \[
      \begin{array}{|c|c|c|c|}
      \hline
      x & f(x) & (x- \mu)^2 & (x - \mu)^2 \cdot f(x)\\
      \hline
      0 & 0.75 & (0-6)^2 = 36 & 36 \cdot 0.75 = 27\\
      5 & 0.2 & (5-6)^2 = 1 & 1 \cdot 0.2 = 0.2\\
      100 & 0.05 & (100-6)^2 = 8836 & 8836 \cdot 0.05 = 441.8
      \hline
      \end{array}
      \]
      \[\sigma = \sqrt{27 + 0.2 + 441.8} = \approx 21.67\]
    </p>

    

    <div class="button-container">
      <button id="start-btn" class="rubber-button">Start!</button>
    </div>
    
    <p id="question-text" class="math"></p>

    <div class="button-container">
      <button id="hint-btn" class="rubber-button">Hint</button>
    </div>
    
    <div id="hint-area" class="math" style="margin-top: 1em; text-align: center"></div>


    <div id="answer-section" style="margin-top: 20px; text-align: center;">
      <label for="user-answer">Enter your answer:</label>
      <input type="text" id="user-answer" />
      <button id="check-answer-btn" class="rubber-button" style="margin-left: 0.5em;">Check Answer</button>
      <p id="answer-feedback" style="font-weight: bold; margin-top: 10px;"></p>
    </div>

  </main>
  <script>
  const hintBtn = document.getElementById('hint-btn');
  const hintArea = document.getElementById('hint-area');
  let hintSteps = [];
  let hintIndex = 0;

  const startBtn = document.getElementById('start-btn');
  const questionText = document.getElementById('question-text');

  const answerInput = document.getElementById('user-answer');
  const feedback = document.getElementById('answer-feedback');

  // Correct answer stored as reduced fraction num/den
  let currentAnsNum = null;
  let currentAnsDen = null;

  // -----------------------------
  // Helpers
  // -----------------------------
  function playSound(id) {
    const s = document.getElementById(id);
    if (s) {
      s.currentTime = 0;
      s.play();
    }
  }

  function randInt(a, b) {
    return Math.floor(Math.random() * (b - a + 1)) + a;
  }

  function gcd(a, b) {
    a = Math.abs(a); b = Math.abs(b);
    while (b !== 0) {
      const t = a % b;
      a = b;
      b = t;
    }
    return a === 0 ? 1 : a;
  }

  function reduceFrac(num, den) {
    if (den < 0) { den = -den; num = -num; }
    const g = gcd(num, den);
    return [num / g, den / g];
  }

  function setAnswer(num, den) {
    const r = reduceFrac(num, den);
    currentAnsNum = r[0];
    currentAnsDen = r[1];
  }

  function resetUIForNewQuestion() {
    feedback.textContent = '';
    feedback.style.color = 'black';
    answerInput.value = '';
    hintArea.innerHTML = '';
    hintSteps = [];
    hintIndex = 0;
  }


  function typeset(elements = []) {
    if (!window.MathJax) return;
    if (MathJax.typesetPromise) {
      if (elements.length > 0) MathJax.typesetPromise(elements);
      else MathJax.typesetPromise();
      return;
    }
    if (MathJax.typeset) {
      if (elements.length > 0) MathJax.typeset(elements);
      else MathJax.typeset();
    }
  }

  function toDecimalString(num, den) {
    const x = num / den;
    let s = x.toFixed(2);
    s = s.replace(/0+$/, '').replace(/\.$/, '');
    return s;
  }

  function joinWithOr(items) {
    if (items.length === 1) return items[0];
    if (items.length === 2) return `${items[0]} or ${items[1]}`;
    return `${items.slice(0, -1).join(', ')}, or ${items[items.length - 1]}`;
  }

  function singularize(word) {
    // Good enough for your current banks (apples->apple, SUVs->SUV, etc.)
    if (word.endsWith('s')) return word.slice(0, -1);
    return word;
  }

  function articleFor(word) {
    const first = word[0];
    const vowelLetter = /^[aeiou]/i.test(first);
    const anInitialism = /^[FHLMNRSX]/.test(first); // “an” F, H, L, M, N, R, S, X
    return (vowelLetter || anInitialism) ? 'an' : 'a';
  }


  function fracTex(num, den) {
    const r = reduceFrac(num, den);
    const n = r[0], d = r[1];
    if (d === 1) return `\\frac{${n}}{${d}}`;
    return `\\frac{${n}}{${d}}`;
  }

  function parseUserAnswer(raw) {
    // Accept:
    //  - integer: "3"
    //  - fraction: "3/8"
    //  - decimal: "0.375"
    //
    // Returns:
    //  { kind:'exact', num, den } for integer/fraction
    //  { kind:'decimal', value, relTol } for decimals (graded by relative tolerance)
    const s = raw.replace(/\s+/g, '');

    // Fraction a/b
    const fracMatch = s.match(/^([+-]?\d+)\/([+-]?\d+)$/);
    if (fracMatch) {
      const a = parseInt(fracMatch[1], 10);
      const b = parseInt(fracMatch[2], 10);
      if (b === 0) return { error: 'Denominator cannot be 0.' };
      const [rn, rd] = reduceFrac(a, b);
      return { kind: 'exact', num: rn, den: rd };
    }

    // Integer
    const intMatch = s.match(/^[+-]?\d+$/);
    if (intMatch) {
      const a = parseInt(s, 10);
      return { kind: 'exact', num: a, den: 1 };
    }

    // Decimal
    const decMatch = s.match(/^[+-]?\d*\.\d+$/);
    if (decMatch) {
      const value = Number(s);
      if (!Number.isFinite(value)) return { error: 'That decimal does not look valid.' };
      if (value < 0) return { error: 'Probabilities cannot be negative.' };
      // Allow decimals; grade with 0.01% relative tolerance
      return { kind: 'decimal', value, relTol: 0.0001 };
    }

    return { error: 'I couldn’t parse that. Use a fraction like 3/8 or a decimal like 0.375.' };
  }

  function isCorrect(parsed) {
    if (currentAnsNum === null || currentAnsDen === null) return false;
    const correctVal = currentAnsNum / currentAnsDen;

    if (!parsed || parsed.error) return false;

    if (parsed.kind === 'exact') {
      const [uNum, uDen] = reduceFrac(parsed.num, parsed.den);
      return (uNum === currentAnsNum && uDen === currentAnsDen);
    }

    if (parsed.kind === 'decimal') {
      const denom = Math.max(1e-12, Math.abs(correctVal));
      return Math.abs(parsed.value - correctVal) <= parsed.relTol * denom;
    }

    return false;
  }

  // -----------------------------
  // Banks
  // -----------------------------
  const type1Bank = [
    { categorySing: 'fruit', categoryPlur: 'fruits', items: ['apples', 'bananas', 'oranges', 'pears', 'grapefruits'] },
    { categorySing: 'animal', categoryPlur: 'animals', items: ['cats', 'dogs', 'birds', 'bears', 'lions'] },
    { categorySing: 'musical instrument', categoryPlur: 'musical instruments', items: ['trumpets', 'flutes', 'clarinets', 'tubas', 'saxophones'] },
    { categorySing: 'piece of furniture', categoryPlur: 'pieces of furniture', items: ['chairs', 'tables', 'couches', 'beds', 'dressers'] },
    { categorySing: 'utensil', categoryPlur: 'utensils', items: ['forks', 'spoons', 'knives', 'spatulas', 'whisks'] },
    { categorySing: 'vehicle', categoryPlur: 'vehicles', items: ['sedans', 'jeeps', 'SUVs', 'trucks', 'vans'] },
    { categorySing: 'shape', categoryPlur: 'shapes', items: ['squares', 'triangles', 'circles', 'pentagons', 'hexagons'] }
  ];

  const type3Bank = [
    { e: 'it rains', f: 'the temperature is below 5°C' },
    { e: 'you score a touchdown', f: 'you are the game MVP' },
    { e: 'the Best Actor winner is from Europe', f: 'the Best Actor winner is over 40 years old' },
    { e: 'a newborn has brown hair', f: 'a newborn weighs more than 8 lbs at birth' },
    { e: 'a randomly selected email is spam', f: 'the email contains the word “free”' },
    { e: 'a randomly selected day is a weekend', f: 'it rains that day' },
    { e: 'a student passes the final exam', f: 'the student studied at least 5 hours' },
    { e: 'a customer buys something', f: 'the customer used a coupon' }
  ];

  const type4Bank = [
    {
      population: 'employees at Ben Co',
      member: 'employee',
      aLabel: 'lawyers at Ben Co',
      bLabel: 'employees at Ben Co earning more than 100K'
    },
    {
      population: 'students at VIU',
      member: 'student',
      aLabel: 'students enrolled in Math 132',
      bLabel: 'students enrolled in Math 161'
    },
    {
      population: 'players in the NHL',
      member: 'player',
      aLabel: 'centers in the NHL',
      bLabel: 'players in the NHL who have averaged more than a point per game'
    },
    {
      population: 'books in a library',
      member: 'book',
      aLabel: 'fiction books',
      bLabel: 'books currently checked out'
    },
    {
      population: 'cars in a parking lot',
      member: 'car',
      aLabel: 'cars that are SUVs',
      bLabel: 'cars that are electric'
    }
  ];

  // -----------------------------
  // Type 1
  // -----------------------------
  function generateType1() {
    const scenario = type1Bank[randInt(0, type1Bank.length - 1)];

    const N = randInt(20, 80);
    const k = randInt(2, 5);

    // choose k distinct items from the 5
    const indices = [0, 1, 2, 3, 4];
    for (let i = indices.length - 1; i > 0; i--) {
      const j = randInt(0, i);
      [indices[i], indices[j]] = [indices[j], indices[i]];
    }
    const chosenTypesIdx = indices.slice(0, k);
    const chosenTypes = chosenTypesIdx.map(i => scenario.items[i]);

    // random positive parts summing to N
    let cuts = [];
    for (let i = 0; i < k - 1; i++) cuts.push(randInt(1, N - 1));
    cuts.sort((a, b) => a - b);

    const counts = [];
    let prev = 0;
    for (let i = 0; i < cuts.length; i++) {
      counts.push(cuts[i] - prev);
      prev = cuts[i];
    }
    counts.push(N - prev);

    // choose between 1 and k-1 of the pieces for the OR question
    const m = randInt(1, k - 1);
    const idx2 = [...Array(k).keys()];
    for (let i = idx2.length - 1; i > 0; i--) {
      const j = randInt(0, i);
      [idx2[i], idx2[j]] = [idx2[j], idx2[i]];
    }
    const picked = idx2.slice(0, m).sort((a, b) => a - b);

    const favorable = picked.reduce((acc, i) => acc + counts[i], 0);
    setAnswer(favorable, N);

    const breakdown = chosenTypes
      .map((t, i) => `${counts[i]} ${t}`)
      .join(', ');

    const askedTypes = picked.map(i => chosenTypes[i]);
    const askedSingles = askedTypes.map(t => {
      const s = singularize(t);
      return `${articleFor(s)} ${s}`;
    });
    const askedPhrase = joinWithOr(askedSingles);

    questionText.textContent =
      `A ${scenario.categorySing} is randomly selected from a set of ${N} ${scenario.categoryPlur}. ` +
      `There are ${breakdown}. ` +
      `What is the probability that ${askedPhrase} is selected?`;

    hintSteps = [
  `Add the counts for the types listed in the question to get the number of favorable outcomes.`,
  `There are ${picked.map(i => counts[i]).join(' + ')} = ${favorable} ${scenario.categoryPlur} which are ${askedTypes.join(' or ')}.`,
  `Divide by the total number of outcomes (the total size of the set).`,
  `The proportion of ${scenario.categoryPlur} which are ${askedTypes.join(' or ')} is \\(${fracTex(favorable, N)}\\).`
];
  }

  // -----------------------------
  // Type 2
  // -----------------------------
  function generateType2() {
    const n = randInt(10, 100);
    const r = randInt(1, 3);

    const points = new Set();
    while (points.size < 2 * r) points.add(randInt(1, n));
    const sorted = Array.from(points).sort((a, b) => a - b);

    const intervals = [];
    for (let i = 0; i < sorted.length; i += 2) {
      let a = sorted[i], b = sorted[i + 1];
      if (b < a) [a, b] = [b, a];
      intervals.push([a, b]);
    }
    intervals.sort((I, J) => I[0] - J[0]);

    const disjoint = [];
    for (const [s, t] of intervals) {
      if (disjoint.length === 0) disjoint.push([s, t]);
      else {
        const last = disjoint[disjoint.length - 1];
        if (s > last[1]) disjoint.push([s, t]);
        else {
          const ns = last[1] + 1;
          if (ns <= t) disjoint.push([ns, t]);
        }
      }
    }

    while (disjoint.length < r) {
      const x = randInt(1, n);
      let ok = true;
      for (const [s, t] of disjoint) if (x >= s && x <= t) ok = false;
      if (ok) disjoint.push([x, x]);
      if (disjoint.length > 10) break;
    }

    disjoint.sort((I, J) => I[0] - J[0]);
    const finalIntervals = disjoint.slice(0, r);

    let outerUsed = 0;
    const phrases = finalIntervals.map(([s, t]) => {
      if (s === 1 && outerUsed < 2) {
        outerUsed++;
        return `less than ${t + 1}`;
      }
      if (t === n && outerUsed < 2) {
        outerUsed++;
        return `${s} or higher`;
      }
      if (s === t) return `exactly ${s}`;
      return `between ${s} and ${t} (inclusive)`;
    });

    const favorable = finalIntervals.reduce((acc, [s, t]) => acc + (t - s + 1), 0);
    setAnswer(favorable, n);

    questionText.textContent =
      `A ${n}-sided die is rolled. ` +
      `What is the probability that the number rolled is ${joinWithOr(phrases)}?`;

    hintSteps = [
  `Count how many outcomes satisfy at least one of the listed conditions.`,
  `There are ${favorable} natural numbers which are ${joinWithOr(phrases)}.`,
  `Divide by the total number of outcomes (${n}).`,
  `The proportion of natural numbers which are ${n} or less that are ${joinWithOr(phrases)} is \\(${fracTex(favorable, n)}\\).`
];
  }

  // -----------------------------
  // Type 3
  // -----------------------------
  function generateType3() {
    const scenario = type3Bank[randInt(0, type3Bank.length - 1)];

    const den = 100;
    const pE = randInt(10, 80);
    const pF = randInt(10, 80);

    const minInt = Math.max(0, pE + pF - den);
    const maxInt = Math.min(pE, pF);
    const pInt = randInt(minInt, maxInt);

    const pUnion = pE + pF - pInt;
    const giveUnion = Math.random() < 0.5;

    if (giveUnion) {
      setAnswer(pInt, den);
      questionText.textContent =
        `There is a ${toDecimalString(pE, den)} probability that ${scenario.e}, ` +
        `a ${toDecimalString(pF, den)} probability that ${scenario.f}, ` +
        `and a ${toDecimalString(pUnion, den)} probability that ${scenario.e} or ${scenario.f}. ` +
        `What is the probability that ${scenario.e} and ${scenario.f}?`;
    } else {
      setAnswer(pUnion, den);
      questionText.textContent =
        `There is a ${toDecimalString(pE, den)} probability that ${scenario.e}, ` +
        `a ${toDecimalString(pF, den)} probability that ${scenario.f}, ` +
        `and a ${toDecimalString(pInt, den)} probability that ${scenario.e} and ${scenario.f}. ` +
        `What is the probability that ${scenario.e} or ${scenario.f}?`;
    }

    hintSteps = (() => {
  const eText = scenario.e;
  const fText = scenario.f;

  if (giveUnion) {
    return [
      `Use inclusion-exclusion.`,
      `Rearrange depending on which quantity you’re missing.`,
      `\\(P(E \\cap F) = P(E) + P(F) - P(E \\cup F)\\)`,
      `Let \\(E\\) be the event that ${eText}, and let \\(F\\) be the event that ${fText}.`,
      `Substitute: \\(P(E \\cap F) = ${fracTex(pE, den)} + ${fracTex(pF, den)} - ${fracTex(pUnion, den)} = ${fracTex(pInt, den)}\\).`
    ];
  } else {
    return [
      `Use inclusion-exclusion.`,
      `Rearrange depending on which quantity you’re missing.`,
      `\\(P(E \\cup F) = P(E) + P(F) - P(E \\cap F)\\)`,
      `Let \\(E\\) be the event that ${eText}, and let \\(F\\) be the event that ${fText}.`,
      `Substitute: \\(P(E \\cup F) = ${fracTex(pE, den)} + ${fracTex(pF, den)} - ${fracTex(pInt, den)} = ${fracTex(pUnion, den)}\\).`
    ];
  }
})();
  }

  // -----------------------------
  // Type 4
  // -----------------------------
  function generateType4() {
    const scenario = type4Bank[randInt(0, type4Bank.length - 1)];

    const N = randInt(80, 600);
    const a = randInt(10, Math.floor(0.75 * N));
    const b = randInt(10, Math.floor(0.75 * N));

    const giveUnion = Math.random() < 0.5;

    let u;
    let inter;

    if (giveUnion) {
      const uMin = Math.max(a, b);
      const uMax = Math.min(N, a + b);
      u = randInt(uMin, uMax);
      inter = a + b - u;

      setAnswer(inter, N);

      questionText.textContent =
        `There are ${N} ${scenario.population}. ` +
        `${a} are ${scenario.aLabel}, ${b} are ${scenario.bLabel}, ` +
        `and ${u} are ${scenario.aLabel} or ${scenario.bLabel}. ` +
        `If a ${scenario.member} is selected at random, what is the probability they are ` +
        `${scenario.aLabel} and ${scenario.bLabel}?`;
    } else {
      const iMin = Math.max(0, a + b - N);
      const iMax = Math.min(a, b);
      inter = randInt(iMin, iMax);
      u = a + b - inter;

      setAnswer(u, N);

      questionText.textContent =
        `There are ${N} ${scenario.population}. ` +
        `${a} are ${scenario.aLabel}, ${b} are ${scenario.bLabel}, ` +
        `and ${inter} are ${scenario.aLabel} and ${scenario.bLabel}. ` +
        `If a ${scenario.member} is selected at random, what is the probability they are ` +
        `${scenario.aLabel} or ${scenario.bLabel}?`;
    }

    hintSteps = (() => {
  const A = scenario.aLabel;
  const B = scenario.bLabel;

  if (giveUnion) {
    return [
      `Use inclusion-exclusion: \\(|A \\cup B| = |A| + |B| - |A \\cap B|\\).`,
      `Find the missing amount, \\(|A \\cap B|\\).`,
      `Let \\(A =\\) ${A} and let \\(B =\\) ${B}.`,
      `Substitute: \\(${u} = ${a} + ${b} - |A \\cap B|\\).`,
      `So \\(|A \\cap B| = ${a} + ${b} - ${u} = ${inter}\\).`,
      `Divide by the total population to get the probability.`,
      `The proportion of ${scenario.population} which are ${A} and ${B} is \\(${fracTex(inter, N)}\\).`
    ];
  } else {
    return [
      `Use inclusion-exclusion: \\(|A \\cup B| = |A| + |B| - |A \\cap B|\\).`,
      `Find the missing amount, \\(|A \\cup B|\\).`,
      `Let \\(A =\\) ${A} and let \\(B =\\) ${B}.`,
      `Substitute: \\(|A \\cup B| = ${a} + ${b} - ${inter}\\).`,
      `So \\(|A \\cup B| = ${u}\\).`,
      `Divide by the total population to get the probability.`,
      `The proportion of ${scenario.population} which are ${A} or ${B} is \\(${fracTex(u, N)}\\).`
    ];
  }
})();
  }

  // -----------------------------
  // Start: generate a question
  // -----------------------------
  startBtn.addEventListener('click', () => {
    playSound('click-sound');
    resetUIForNewQuestion();

    const qType = randInt(1, 4);

    if (qType === 1) generateType1();
    if (qType === 2) generateType2();
    if (qType === 3) generateType3();
    if (qType === 4) generateType4();
  });

  // -----------------------------
  // Check answer
  // -----------------------------
  document.getElementById('check-answer-btn').addEventListener('click', () => {
    playSound('click-sound');

    const raw = answerInput.value.trim();
    if (!raw) {
      feedback.textContent = 'Please enter an answer.';
      feedback.style.color = 'black';
      return;
    }

    const parsed = parseUserAnswer(raw);
    if (parsed.error) {
      feedback.textContent = parsed.error;
      feedback.style.color = 'black';
      return;
    }

    if (isCorrect(parsed)) {
      feedback.textContent = 'Correct!';
      feedback.style.color = 'green';
    } else {
      const exact = `${currentAnsNum}/${currentAnsDen}`;
      const dec = (currentAnsNum / currentAnsDen).toFixed(6).replace(/0+$/, '').replace(/\.$/, '');
      feedback.textContent = `Not quite. Correct answer is ${exact} (≈ ${dec}).`;
      feedback.style.color = 'crimson';
    }
  });

  // -----------------------------
  // Hint button (centered)
  // -----------------------------
  hintBtn.addEventListener('click', () => {
    playSound('click-sound');

    if (!hintSteps || hintSteps.length === 0) {
      const hintPara = document.createElement('div');
      hintPara.classList.add('hint-step');
      hintPara.style.textAlign = 'center';
      hintPara.textContent = 'No hints are available for this question.';
      hintArea.appendChild(hintPara);
      typeset([hintPara]);
      return;
    }

    if (hintIndex < hintSteps.length) {
      const hintPara = document.createElement('div');
      hintPara.classList.add('hint-step');
      hintPara.style.textAlign = 'center';
      hintPara.innerHTML = hintSteps[hintIndex];
      hintArea.appendChild(hintPara);
      typeset([hintPara]);
      hintIndex++;
    }
  });
</script>


  <audio id="click-sound" src="button.mp3" preload="auto"></audio>
  <audio id="set-sound" src="set2.mp3" preload="auto"></audio>

</body>
</html>
