<nav class="navbar">
  <ul class="nav-menu">
    <li><a href="/index.html">Home</a></li>

    <li class="dropdown">
      <a href="/courses/">Courses</a>
      <ul class="dropdown-content">
        <li class="dropdown-sub">
          <a href="/courses/math121/index.html">MATH 121</a>
          <ul class="dropdown-content-sub">
            <li><a href="/courses/math121/epsilondelta.html">Epsilon-Delta</a></li>
            <li><a href="/courses/math121/polynomial.html">Polynomial Differentiation</a></li>
            <li><a href="/courses/math121/differentiation.html">Differentiation Rules</a></li>
          </ul>
        </li>
        <li class="dropdown-sub">
          <a href="/courses/math131/index.html">MATH 131</a>
          <ul class="dropdown-content-sub">
            <li><a href="/courses/math131/readings.html">Readings</a></li>
            <li><a href="/courses/math131/setcardinality.html">Set Cardinality</a></li>
            <li><a href="/courses/math131/basechange.html">Change of Base</a></li>
            <li><a href="/courses/math131/arithmetic.html">An Arithmetic Strategy</a></li>
            <li><a href="/courses/math131/addition.html">Addition</a></li>
            <li><a href="/courses/math131/subtraction.html">Subtraction</a></li>
            <li><a href="/courses/math131/multiplication.html">Multiplication</a></li>
            <li><a href="/courses/math131/division.html">Division</a></li>
            <li><a href="/courses/math131/unitconversion.html">Unit Conversion</a></li>
          </ul>
        </li>
      </ul>
    </li>

    <li class="dropdown">
      <a href="/other/">Other</a>
      <ul class="dropdown-content">
        <li><a href="/other/exponents.html">Exponent Laws</a></li>
        <li><a href="/other/resources.html">Resources</a></li>
        <li><a href="/other/ramblings.html">Ramblings</a></li>
        <li><a href="/other/cartoons.html">Cartoons</a></li>
      </ul>
    </li>

    <li><a href="#" id="help-link">Help</a></li>
  </ul>
</nav>

<!-- Mascot overlay (hidden by default) -->
<div id="mascot" hidden style="
  position: fixed; right: 16px; bottom: 16px; z-index: 10000;
  display: flex; align-items: flex-end; gap: 10px; font-family: system-ui, sans-serif;">
  <img id="mascot-img" alt="Help mascot" style="width:180px; height:auto; pointer-events:none;">
  <div id="mascot-bubble" style="
    max-width: 280px; padding: 10px 12px; border-radius: 12px;
    background:#fff; border:2px solid #111; box-shadow:0 6px 24px rgba(0,0,0,.15);">
    Need a hand?
  </div>
  <button id="mascot-close" aria-label="Close" style="
    position:absolute; top:-8px; right:-8px; width:28px; height:28px;
    border-radius:50%; border:2px solid #111; background:#fff; cursor:pointer;">Ã—</button>
</div>


<script>
(() => {
  const HELP_LINK_ID = 'help-link';
  const MASCOT_ID = 'mascot';
  const MASCOT_IMG_ID = 'mascot-img';
  const MASCOT_CLOSE_ID = 'mascot-close';

  const MASCOT_SRC = '/protacty.png';

  let mascotReady = false;
  let processedURL = null;

  async function loadAndKeyWhite(src) {
    const img = new Image();
    img.crossOrigin = 'anonymous';
    img.src = src;
    await img.decode();

    const c = document.createElement('canvas');
    c.width = img.width; c.height = img.height;
    const ctx = c.getContext('2d');
    ctx.drawImage(img, 0, 0);

    const data = ctx.getImageData(0, 0, c.width, c.height);
    const d = data.data;
    for (let i = 0; i < d.length; i += 4) {
      const r = d[i], g = d[i+1], b = d[i+2];
      // treat near-white as transparent; tweak thresholds if needed
      if (r > 245 && g > 245 && b > 245) d[i+3] = 0;
    }
    ctx.putImageData(data, 0, 0);
    return c.toDataURL('image/png');
  }

  async function showMascot() {
    const wrap = document.getElementById(MASCOT_ID);
    const imgEl = document.getElementById(MASCOT_IMG_ID);

    if (!mascotReady) {
      try {
        processedURL = await loadAndKeyWhite(MASCOT_SRC);
        imgEl.src = processedURL;
        mascotReady = true;
      } catch (e) {
        console.error('Mascot load failed:', e);
        imgEl.src = MASCOT_SRC; // fallback (white bg)
      }
    }
    wrap.hidden = false;
  }

  function hideMascot() {
    document.getElementById(MASCOT_ID).hidden = true;
  }

  document.addEventListener('DOMContentLoaded', () => {
    const helpLink = document.getElementById(HELP_LINK_ID);
    const closeBtn = document.getElementById(MASCOT_CLOSE_ID);

    if (helpLink) {
      helpLink.addEventListener('click', (e) => {
        e.preventDefault();
        showMascot();
      });
    }
    if (closeBtn) closeBtn.addEventListener('click', hideMascot);
  });
})();
</script>

